# üí≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¢-–ë–∞–Ω–∫ –ú—É–ª—å—Ç–∏—Ä–∞—Å—á–µ—Ç—ã

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –ú—É–ª—å—Ç–∏—Ä–∞—Å—á–µ—Ç–æ–≤ –æ—Ç –¢-–ë–∞–Ω–∫–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø—Ä–∏–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –∏ –≤—ã–ø–ª–∞—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º.

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ú—É–ª—å—Ç–∏—Ä–∞—Å—á–µ—Ç–æ–≤:

- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–¥–µ–ª–∫–∏** - –¥–µ–Ω—å–≥–∏ —Ö–æ–ª–¥–∏—Ä—É—é—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±–∞–Ω–∫–∞
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–ø–ª–∞—Ç—ã** - —á–µ—Ä–µ–∑ –°–ë–ü, –Ω–∞ –∫–∞—Ä—Ç—ã –∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º
- ‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ **–ó–∞—â–∏—Ç–∞** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞–Ω—Ç–∏—Ñ—Ä–æ–¥ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ **–ö–æ–º–∏—Å—Å–∏–∏** - –≥–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–º–∏—Å—Å–∏–π

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `.env`:

```env
# –¢-–ë–∞–Ω–∫ –ú—É–ª—å—Ç–∏—Ä–∞—Å—á–µ—Ç—ã - –¢–µ—Ä–º–∏–Ω–∞–ª –¥–ª—è –ø—Ä–∏–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π
TBANK_TERMINAL_KEY="your_terminal_key"
TBANK_TERMINAL_PASSWORD="your_terminal_password"

# –¢-–ë–∞–Ω–∫ –ú—É–ª—å—Ç–∏—Ä–∞—Å—á–µ—Ç—ã - E2C —Ç–µ—Ä–º–∏–Ω–∞–ª –¥–ª—è –≤—ã–ø–ª–∞—Ç
TBANK_E2C_TERMINAL_KEY="your_e2c_terminal_key"
TBANK_E2C_TERMINAL_PASSWORD="your_e2c_password"

# –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (production –∏–ª–∏ test)
TBANK_MODE="test"

# –ë–∞–∑–æ–≤—ã–π URL —Å–∞–π—Ç–∞
NEXT_PUBLIC_BASE_URL="https://nesi.su"
```

### 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
cd NESI
npx prisma migrate dev --name add_tbank_multisplit
npx prisma generate
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –¢-–ë–∞–Ω–∫–∞

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –¢-–ë–∞–Ω–∫ –ë–∏–∑–Ω–µ—Å](https://business.tbank.ru)
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ **Notification URL**: `https://nesi.su/api/tbank/webhook`
3. –ü–æ–ª—É—á–∏—Ç–µ **TerminalKey** –∏ **Password** –¥–ª—è –æ–±–æ–∏—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ IP whitelist (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend (API)

| –§–∞–π–ª                                          | –û–ø–∏—Å–∞–Ω–∏–µ                                       |
| --------------------------------------------- | ---------------------------------------------- |
| `src/lib/tbank/crypto.ts`                     | –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Token –∏ –ø–æ–¥–ø–∏—Å–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ |
| `src/lib/tbank/config.ts`                     | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è            |
| `src/lib/tbank/client.ts`                     | –ö–ª–∏–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API –¢-–ë–∞–Ω–∫–∞               |
| `src/app/api/tbank/deals/create/route.ts`     | –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏                                |
| `src/app/api/tbank/deals/close/route.ts`      | –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–¥–µ–ª–∫–∏                                |
| `src/app/api/tbank/deposit/init/route.ts`     | –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è                           |
| `src/app/api/tbank/deposit/confirm/route.ts`  | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞                          |
| `src/app/api/tbank/withdraw/init/route.ts`    | –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –≤—ã–≤–æ–¥–∞                               |
| `src/app/api/tbank/withdraw/execute/route.ts` | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã                             |
| `src/app/api/tbank/webhook/route.ts`          | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–π                         |

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Models)

| –ú–æ–¥–µ–ª—å         | –û–ø–∏—Å–∞–Ω–∏–µ                            |
| -------------- | ----------------------------------- |
| `TBankDeal`    | –°–¥–µ–ª–∫–∞ –ú—É–ª—å—Ç–∏—Ä–∞—Å—á–µ—Ç–æ–≤               |
| `TBankPayment` | –ü–ª–∞—Ç–µ–∂ (–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ) –≤ —Ä–∞–º–∫–∞—Ö —Å–¥–µ–ª–∫–∏ |
| `TBankPayout`  | –í—ã–ø–ª–∞—Ç–∞ –≤ —Ä–∞–º–∫–∞—Ö —Å–¥–µ–ª–∫–∏             |
| `DealStatus`   | Enum —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–¥–µ–ª–∫–∏                |

---

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

### –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ (–æ—Ç –ø–æ–∫—É–ø–∞—Ç–µ–ª—è)

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø—Ä–æ—Ñ–∏–ª—è
2. **–°–∏—Å—Ç–µ–º–∞** –≤—ã–∑—ã–≤–∞–µ—Ç `/api/tbank/deposit/init`:
   - –°–æ–∑–¥–∞–µ—Ç –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç –æ—Ç–∫—Ä—ã—Ç—É—é —Å–¥–µ–ª–∫—É
   - –í—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ `/v2/Init` –¢-–ë–∞–Ω–∫–∞
   - –ü–æ–ª—É—á–∞–µ—Ç `PaymentURL` –¥–ª—è –æ–ø–ª–∞—Ç—ã
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Ñ–æ—Ä–º—É –æ–ø–ª–∞—Ç—ã –¢-–ë–∞–Ω–∫–∞
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ–π
5. **–¢-–ë–∞–Ω–∫** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –Ω–∞ `/api/tbank/webhook` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `CONFIRMED`
6. **–°–∏—Å—Ç–µ–º–∞** –Ω–∞—á–∏—Å–ª—è–µ—Ç –¥–µ–Ω—å–≥–∏ –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ (–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é)

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** —É–∫–∞–∑—ã–≤–∞–µ—Ç —Å—É–º–º—É –∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –Ω–∞–∂–∏–º–∞–µ—Ç "–í—ã–≤–µ—Å—Ç–∏"
2. **–°–∏—Å—Ç–µ–º–∞** –≤—ã–∑—ã–≤–∞–µ—Ç `/api/tbank/withdraw/init`:
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å –∏ –∞–Ω—Ç–∏—Ñ—Ä–æ–¥
   - –ó–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞
   - –°–æ–∑–¥–∞–µ—Ç –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç –æ—Ç–∫—Ä—ã—Ç—É—é —Å–¥–µ–ª–∫—É
   - –í—ã–∑—ã–≤–∞–µ—Ç `/e2c/v2/Init` –¥–ª—è –∏–Ω–∏—Ü–∏–∞—Ü–∏–∏ –≤—ã–ø–ª–∞—Ç—ã
3. **–°–∏—Å—Ç–µ–º–∞** –≤—ã–∑—ã–≤–∞–µ—Ç `/api/tbank/withdraw/execute`:
   - –í—ã–∑—ã–≤–∞–µ—Ç `/e2c/v2/Payment` –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—ã–ø–ª–∞—Ç—ã
4. **–¢-–ë–∞–Ω–∫** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `COMPLETED`
5. **–°–∏—Å—Ç–µ–º–∞** —Å–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å –±–∞–ª–∞–Ω—Å–∞ –∏ —Ä–∞–∑–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ (Token)

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API –¢-–ë–∞–Ω–∫–∞ –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É:

```typescript
// 1. –°–æ–±—Ä–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã + Password
const params = { TerminalKey, Amount, OrderId, Password }

// 2. –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∫–ª—é—á–∞–º
const sorted = Object.keys(params).sort()

// 3. –ö–æ–Ω–∫–∞—Ç–µ–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è
const concatenated = sorted.map(k => params[k]).join('')

// 4. SHA-256
const token = crypto.createHash('sha256').update(concatenated).digest('hex')
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook

–í `webhook/route.ts` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å—å –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:

```typescript
const isValid = verifyTBankToken(body, body.Token, password)
if (!isValid) {
	return new Response('INVALID_SIGNATURE', { status: 400 })
}
```

---

## üìä –°—Ç–∞—Ç—É—Å—ã —Å–¥–µ–ª–æ–∫ –∏ –ø–ª–∞—Ç–µ–∂–µ–π

### –°—Ç–∞—Ç—É—Å—ã —Å–¥–µ–ª–∫–∏ (Deal)

- `OPEN` - –û—Ç–∫—Ä—ã—Ç–∞, –µ—Å—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
- `PARTIAL_CANCELED` - –ß–∞—Å—Ç–∏—á–Ω–æ –æ—Ç–º–µ–Ω–µ–Ω–∞
- `CLOSED` - –ó–∞–∫—Ä—ã—Ç–∞ (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤—ã–ø–ª–∞—Ç–∞ –∏–ª–∏ –º–µ—Ç–æ–¥ closeSpDeal)

### –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–∞ (–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ)

- `NEW` - –°–æ–∑–¥–∞–Ω
- `AUTHORIZED` - –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω (–¥–µ–Ω—å–≥–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
- `CONFIRMED` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω (–¥–µ–Ω—å–≥–∏ —Å–ø–∏—Å–∞–Ω—ã)
- `REJECTED` - –û—Ç–∫–ª–æ–Ω–µ–Ω
- `CANCELED` - –û—Ç–º–µ–Ω–µ–Ω

### –°—Ç–∞—Ç—É—Å—ã –≤—ã–ø–ª–∞—Ç—ã

- `NEW` - –°–æ–∑–¥–∞–Ω–∞
- `CHECKED` - –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ (–≥–æ—Ç–æ–≤–∞ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é)
- `COMPLETING` - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- `COMPLETED` - –ó–∞–≤–µ—Ä—à–µ–Ω–∞
- `REJECTED` - –û—Ç–∫–ª–æ–Ω–µ–Ω–∞

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã (–¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è)

```
–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞:
PAN: 2200770239097761
ExpDate: 12/25
CVV: 123

–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤:
PAN: 4249170392197566
ExpDate: 12/25
CVV: 123
```

### –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –°–ë–ü (–≤—ã–ø–ª–∞—Ç—ã)

```
–£—Å–ø–µ—à–Ω–∞—è –≤—ã–ø–ª–∞—Ç–∞:
Phone: 79066589133
SbpMemberId: 100000000004

–û—à–∏–±–∫–∞ (–Ω–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä):
Phone: 79066589134
SbpMemberId: 100000000004
```

---

## üîß API Endpoints

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ endpoints

#### POST `/api/tbank/deposit/init`

–ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

**Request:**

```json
{
	"amount": 1000,
	"phone": "+79001234567"
}
```

**Response:**

```json
{
	"success": true,
	"paymentId": "123456",
	"paymentURL": "https://pay-test.tbank.ru/...",
	"dealId": "deal_..."
}
```

#### POST `/api/tbank/withdraw/init`

–ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤

**Request:**

```json
{
	"amount": 500,
	"phone": "+79001234567"
}
```

**Response:**

```json
{
	"success": true,
	"paymentId": "789012",
	"status": "CHECKED"
}
```

#### POST `/api/tbank/withdraw/execute`

–í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—ã–ø–ª–∞—Ç—É

**Request:**

```json
{
	"paymentId": "789012"
}
```

**Response:**

```json
{
	"success": true,
	"status": "COMPLETED"
}
```

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ endpoints

#### POST `/api/tbank/deals/create`

–°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —Å–¥–µ–ª–∫—É

#### POST `/api/tbank/deals/close`

–ó–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–¥–µ–ª–∫—É

---

## üåê Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Notification URL

–í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –¢-–ë–∞–Ω–∫–∞ —É–∫–∞–∂–∏—Ç–µ:

```
https://nesi.su/api/tbank/webhook
```

### –§–æ—Ä–º–∞—Ç –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

–¢-–ë–∞–Ω–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å:

```json
{
	"TerminalKey": "...",
	"OrderId": "ORDER_...",
	"Success": true,
	"Status": "CONFIRMED",
	"PaymentId": "123456",
	"ErrorCode": "0",
	"Amount": 100000,
	"Token": "..."
}
```

**–í–∞–∂–Ω–æ:** –°–∏—Å—Ç–µ–º–∞ –î–û–õ–ñ–ù–ê –≤–µ—Ä–Ω—É—Ç—å `"OK"` (–±–µ–∑ —Ç–µ–≥–æ–≤, –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏) –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è.

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. –°—Ä–æ–∫ –∂–∏–∑–Ω–∏ —Å–¥–µ–ª–∫–∏

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: **60 –¥–Ω–µ–π**. –ü–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è:

- –ï—Å–ª–∏ –Ω–µ –±—ã–ª–æ –≤—ã–ø–ª–∞—Ç - –≤—Å–µ –ø–ª–∞—Ç–µ–∂–∏ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è
- –ï—Å–ª–∏ –±—ã–ª–∏ –≤—ã–ø–ª–∞—Ç—ã - –æ—Å—Ç–∞—Ç–æ–∫ –≤—ã–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è –ø–ª–æ—â–∞–¥–∫–µ

### 2. –ö–æ–º–∏—Å—Å–∏–∏

–ü–ª–æ—â–∞–¥–∫–∞ –±–µ—Ä–µ—Ç –∫–æ–º–∏—Å—Å–∏—é –∑–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –ú—É–ª—å—Ç–∏—Ä–∞—Å—á–µ—Ç–æ–≤. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –¥–æ–≥–æ–≤–æ—Ä–µ —Å –±–∞–Ω–∫–æ–º.

### 3. –õ–∏–º–∏—Ç—ã

- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: **100 —Ä—É–±–ª–µ–π** (10 —Ä—É–±–ª–µ–π –¥–ª—è –°–ë–ü)
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–≥–æ–≤–æ—Ä—É —Å –±–∞–Ω–∫–æ–º
- –õ–∏–º–∏—Ç—ã –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π: –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ

### 4. IP Whitelist

–î–ª—è production –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å IP —Å–µ—Ä–≤–µ—Ä–∞ –≤ whitelist. –ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞ `acq_help@tbank.ru`

### 5. –ù–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç —Å IP

```
91.194.226.0/23
91.218.132.0/22
212.233.80.0/22
```

---

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞: "–ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å"

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TBANK_TERMINAL_PASSWORD`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Password –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### –û—à–∏–±–∫–∞: "–°–¥–µ–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ –ø–µ—Ä–µ–¥ –ø–ª–∞—Ç–µ–∂–æ–º
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `SpAccumulationId` –≤ –ë–î

### –û—à–∏–±–∫–∞: "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç"

- –°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –¢-–ë–∞–Ω–∫–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞

### Webhook –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Notification URL –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ endpoint `/api/tbank/webhook` –¥–æ—Å—Ç—É–ø–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¢-–ë–∞–Ω–∫–∞ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¢-–ë–∞–Ω–∫–∞

- [–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –ú—É–ª—å—Ç–∏—Ä–∞—Å—á–µ—Ç—ã](./multisplit.md)
- [–ü—Ä–æ—Ç–æ–∫–æ–ª EACQ (–æ–ø–ª–∞—Ç—ã)](./oplatasplit.md)
- [–ü—Ä–æ—Ç–æ–∫–æ–ª A2C_V2 (–≤—ã–ø–ª–∞—Ç—ã)](./vyplatysplit.md)
- [–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤](./api_reg_upd_multisplit.md)

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã

–¢–µ–∫—É—â–∏–µ endpoints `/api/wallet/deposit` –∏ `/api/wallet/withdraw` –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

–ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥ `useTBank` –≤ UI.

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤:

- Email: `acq_help@tbank.ru`
- –¢–µ–ª–µ—Ñ–æ–Ω: —É–∫–∞–∑–∞–Ω –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [developer.tbank.ru](https://developer.tbank.ru)

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

- [ ] –ü–æ–ª—É—á–µ–Ω—ã —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç –¢-–ë–∞–Ω–∫–∞
- [ ] –°–æ–∑–¥–∞–Ω—ã –æ–±–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ (–¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π –∏ –≤—ã–ø–ª–∞—Ç)
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
- [ ] Notification URL –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ –õ–ö –¢-–ë–∞–Ω–∫–∞
- [ ] IP —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–±–∞–≤–ª–µ–Ω –≤ whitelist
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã webhook –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ–º–∏—Å—Å–∏–∏ –∏ –ª–∏–º–∏—Ç—ã

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 21.11.2024  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
