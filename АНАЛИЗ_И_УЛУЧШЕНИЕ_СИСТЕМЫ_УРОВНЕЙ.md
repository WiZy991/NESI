# üîç –ê–Ω–∞–ª–∏–∑ –∏ —É–ª—É—á—à–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —É—Ä–æ–≤–Ω–µ–π (Level System)

**–î–∞—Ç–∞:** –î–µ–∫–∞–±—Ä—å 2025  
**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥

---

## ‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏**
**–§–∞–π–ª:** `src/app/api/users/me/level/route.ts:26`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `status: 'done'`, –Ω–æ –≤ –ë–î —Å—Ç–∞—Ç—É—Å `'completed'`

```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
where: { executorId: user.id, status: 'done' }

// ‚úÖ –î–û–õ–ñ–ù–û –ë–´–¢–¨
where: { executorId: user.id, status: 'completed' }
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** –°–∏—Å—Ç–µ–º–∞ –Ω–µ —Å—á–∏—Ç–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏, XP –Ω–µ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è

---

### 2. **–î–≤–µ —Ä–∞–∑–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å—á–µ—Ç–∞ —É—Ä–æ–≤–Ω–µ–π**

#### –°–∏—Å—Ç–µ–º–∞ 1: –•–∞—Ä–¥–∫–æ–¥ –≤ `/api/users/me/level`
```typescript
const levels = [
  { level: 1, requiredXP: 0 },
  { level: 2, requiredXP: 100 },
  { level: 3, requiredXP: 300 },
  { level: 4, requiredXP: 700 },
  { level: 5, requiredXP: 1500 }
]
```

#### –°–∏—Å—Ç–µ–º–∞ 2: –•–∞—Ä–¥–∫–æ–¥ –≤ `/api/specialists`
```typescript
const BOUNDS = [0, 100, 300, 600, 1000, 1500, 2100]  // 6 —É—Ä–æ–≤–Ω–µ–π!
```

#### –°–∏—Å—Ç–µ–º–∞ 3: –ë–î –º–æ–¥–µ–ª—å `UserLevel` (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!)
```prisma
model UserLevel {
  id          String @id @default(uuid())
  slug        String @unique
  name        String
  description String
  minScore    Int
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —É—Ä–æ–≤–Ω–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞
- –ú–æ–¥–µ–ª—å UserLevel –≤ –ë–î –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

---

### 3. **XP –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î**
**–ü—Ä–æ–±–ª–µ–º–∞:** XP —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ, –Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `user.xp`

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```typescript
const xp = passedTests * 10 + completedTasks * 20 + positiveReviews * 5
// ‚ùå XP –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ user.xp
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ú–µ–¥–ª–µ–Ω–Ω–æ (–∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø–µ—Ä–µ—Å—á–µ—Ç)
- –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π XP
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

---

### 4. **–ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è XP**
**–ü—Ä–æ–±–ª–µ–º–∞:** XP –Ω–µ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏:
- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ (`/api/tasks/[id]/complete`)
- ‚úÖ –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (`/api/cert/attempts/submit`)
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞ (`/api/tasks/[id]/review`)

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞—é—Ç XP –∑–∞ —Å–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è

---

### 5. **–ë–µ–π–¥–∂–∏ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ API —É—Ä–æ–≤–Ω—è**
**–§–∞–π–ª:** `src/app/api/users/me/level/route.ts`  
**–ü—Ä–æ–±–ª–µ–º–∞:** API –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–µ–π–¥–∂–∏, —Ö–æ—Ç—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏—Ö –æ–∂–∏–¥–∞–µ—Ç

```typescript
// ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –æ—Ç–≤–µ—Ç–µ
return NextResponse.json({
  level: currentLevel.level,
  xp,
  // badges: ... // ‚ùå –ù–ï–¢!
})
```

---

### 6. **–§—É–Ω–∫—Ü–∏—è `recalculateLevel` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**
**–§–∞–π–ª:** `src/lib/user/recalculateLevel.ts`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –§—É–Ω–∫—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –Ω–∏–≥–¥–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

---

### 7. **–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —É–∑–Ω–∞—é—Ç, –∫–æ–≥–¥–∞ –ø–æ–≤—ã—Å–∏–ª–∏ —É—Ä–æ–≤–µ–Ω—å

---

## ‚úÖ –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (2-3 —á–∞—Å–∞)

#### 1.1 –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
```typescript
// src/app/api/users/me/level/route.ts:26
where: { executorId: user.id, status: 'completed' } // –±—ã–ª–æ 'done'
```

#### 1.2 –°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ä–∞—Å—á–µ—Ç–∞ —É—Ä–æ–≤–Ω–µ–π
**–°–æ–∑–¥–∞—Ç—å:** `src/lib/level/calculate.ts`

```typescript
import prisma from '@/lib/prisma'

export async function getLevelFromXP(xp: number) {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º UserLevel –∏–∑ –ë–î
  const levels = await prisma.userLevel.findMany({
    orderBy: { minScore: 'asc' }
  })
  
  // –ï—Å–ª–∏ –Ω–µ—Ç —É—Ä–æ–≤–Ω–µ–π –≤ –ë–î, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ
  if (levels.length === 0) {
    return getDefaultLevel(xp)
  }
  
  // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥—Ö–æ–¥–∏—Ç
  let currentLevel = levels[0]
  for (const lvl of levels) {
    if (xp >= lvl.minScore) {
      currentLevel = lvl
    } else {
      break
    }
  }
  
  return currentLevel
}

function getDefaultLevel(xp: number) {
  const defaultLevels = [
    { level: 1, requiredXP: 0 },
    { level: 2, requiredXP: 100 },
    { level: 3, requiredXP: 300 },
    { level: 4, requiredXP: 700 },
    { level: 5, requiredXP: 1500 }
  ]
  // ... –ª–æ–≥–∏–∫–∞
}
```

#### 1.3 –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è XP
**–°–æ–∑–¥–∞—Ç—å:** `src/lib/level/awardXP.ts`

```typescript
import prisma from '@/lib/prisma'
import { recalculateLevel } from './recalculateLevel'

export async function awardXP(userId: string, amount: number, reason: string) {
  const user = await prisma.user.findUnique({
    where: { id: userId },
    select: { xp: true, levelId: true }
  })
  
  if (!user) return
  
  const oldXP = user.xp
  const newXP = oldXP + amount
  const oldLevel = user.levelId
  
  // –û–±–Ω–æ–≤–ª—è–µ–º XP
  await prisma.user.update({
    where: { id: userId },
    data: { xp: newXP }
  })
  
  // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —É—Ä–æ–≤–µ–Ω—å
  await recalculateLevel(userId)
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–≤—ã—Å–∏–ª—Å—è –ª–∏ —É—Ä–æ–≤–µ–Ω—å
  const updatedUser = await prisma.user.findUnique({
    where: { id: userId },
    include: { level: true }
  })
  
  if (updatedUser && updatedUser.levelId !== oldLevel) {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è
    await notifyLevelUp(userId, updatedUser.level!)
  }
  
  return { oldXP, newXP, levelChanged: updatedUser?.levelId !== oldLevel }
}

async function notifyLevelUp(userId: string, level: any) {
  // –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  await prisma.notification.create({
    data: {
      userId,
      type: 'level_up',
      title: 'üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!',
      message: `–í—ã –ø–æ–≤—ã—Å–∏–ª–∏ —É—Ä–æ–≤–µ–Ω—å –¥–æ "${level.name}"!`,
      link: '/level'
    }
  })
}
```

---

### –≠—Ç–∞–ø 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (2-3 —á–∞—Å–∞)

#### 2.1 –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ XP –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏
**–§–∞–π–ª:** `src/app/api/tasks/[id]/complete/route.ts`

```typescript
import { awardXP } from '@/lib/level/awardXP'

// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
if (task.executorId) {
  await awardXP(
    task.executorId,
    20, // +20 XP –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é –∑–∞–¥–∞—á—É
    `–í—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞–¥–∞—á–∞ "${task.title}"`
  )
}
```

#### 2.2 –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ XP –ø—Ä–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
**–§–∞–π–ª:** `src/app/api/cert/attempts/submit/route.ts`

```typescript
import { awardXP } from '@/lib/level/awardXP'

if (passed) {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  
  // –ù–∞—á–∏—Å–ª—è–µ–º XP
  await awardXP(
    user.id,
    10, // +10 XP –∑–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
    `–ü—Ä–æ–π–¥–µ–Ω–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è "${test.subcategory.name}"`
  )
}
```

#### 2.3 –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ XP –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç–∑—ã–≤–∞
**–§–∞–π–ª:** `src/app/api/tasks/[id]/review/route.ts`

```typescript
import { awardXP } from '@/lib/level/awardXP'

// –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–∑—ã–≤–∞
if (rating >= 4) {
  await awardXP(
    toUserId,
    5, // +5 XP –∑–∞ —Ö–æ—Ä–æ—à–∏–π –æ—Ç–∑—ã–≤
    `–ü–æ–ª—É—á–µ–Ω –æ—Ç–∑—ã–≤ ${rating} –∑–≤–µ–∑–¥ –∑–∞ –∑–∞–¥–∞—á—É "${task.title}"`
  )
}
```

---

### –≠—Ç–∞–ø 3: –£–ª—É—á—à–µ–Ω–∏–µ API —É—Ä–æ–≤–Ω—è (1-2 —á–∞—Å–∞)

#### 3.1 –û–±–Ω–æ–≤–∏—Ç—å `/api/users/me/level`
**–§–∞–π–ª:** `src/app/api/users/me/level/route.ts`

```typescript
import { getLevelFromXP } from '@/lib/level/calculate'
import prisma from '@/lib/prisma'

export async function GET(req: NextRequest) {
  // ... –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π XP –∏–∑ –ë–î
  const xp = user.xp || 0
  
  // –ü–æ–ª—É—á–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –∏–∑ –ë–î
  const currentLevel = await getLevelFromXP(xp)
  
  // –ü–æ–ª—É—á–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å
  const nextLevel = await prisma.userLevel.findFirst({
    where: { minScore: { gt: xp } },
    orderBy: { minScore: 'asc' }
  })
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–µ–π–¥–∂–∏
  const badges = await prisma.userBadge.findMany({
    where: { userId: user.id },
    include: { badge: true }
  })
  
  // –ü–æ–¥—Å–∫–∞–∑–∫–∏
  const suggestions = generateSuggestions(user, xp)
  
  return NextResponse.json({
    level: parseInt(currentLevel.slug) || 1,
    levelName: currentLevel.name,
    levelDescription: currentLevel.description,
    xp,
    nextLevelXP: nextLevel?.minScore ?? null,
    xpToNextLevel: nextLevel ? nextLevel.minScore - xp : 0,
    progressPercent: nextLevel
      ? Math.floor(((xp - currentLevel.minScore) / (nextLevel.minScore - currentLevel.minScore)) * 100)
      : 100,
    suggestions,
    badges: badges.map(b => ({
      id: b.badge.id,
      name: b.badge.name,
      description: b.badge.description,
      icon: b.badge.icon,
      earnedAt: b.earnedAt
    }))
  })
}
```

---

### –≠—Ç–∞–ø 4: –£–ª—É—á—à–µ–Ω–∏–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (1-2 —á–∞—Å–∞)

#### 4.1 –£–ª—É—á—à–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Ä–æ–≤–Ω—è
**–§–∞–π–ª:** `src/app/level/page.tsx`

**–£–ª—É—á—à–µ–Ω–∏—è:**
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è (–Ω–µ —Ç–æ–ª—å–∫–æ –Ω–æ–º–µ—Ä)
- –ö—Ä–∞—Å–∏–≤–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
- –ì—Ä–∞—Ñ–∏–∫ –∏—Å—Ç–æ—Ä–∏–∏ XP
- –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

#### 4.2 –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —É—Ä–æ–≤–Ω—è –≤ —Ö–µ–¥–µ—Ä–µ
**–§–∞–π–ª:** `src/components/Header.tsx`

```typescript
// –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å —Ä—è–¥–æ–º —Å –∏–º–µ–Ω–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
{user.level && (
  <span className="text-xs bg-emerald-500/20 text-emerald-300 px-2 py-1 rounded">
    {user.level.name}
  </span>
)}
```

---

### –≠—Ç–∞–ø 5: –°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π (3-4 —á–∞—Å–∞)

#### 5.1 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ –±–µ–π–¥–∂–µ–π
**–°–æ–∑–¥–∞—Ç—å:** `src/lib/badges/checkBadges.ts`

```typescript
export async function checkAndAwardBadges(userId: string) {
  const user = await prisma.user.findUnique({
    where: { id: userId },
    include: {
      executedTasks: true,
      reviewsReceived: true,
      certifications: true,
      badges: { include: { badge: true } }
    }
  })
  
  if (!user) return
  
  const badges = await prisma.badge.findMany()
  const earnedBadgeIds = user.badges.map(b => b.badgeId)
  
  for (const badge of badges) {
    if (earnedBadgeIds.includes(badge.id)) continue
    
    if (checkBadgeCondition(user, badge.condition)) {
      await prisma.userBadge.create({
        data: {
          userId,
          badgeId: badge.id
        }
      })
      
      // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ–ª—É—á–µ–Ω–∏–∏ –±–µ–π–¥–∂–∞
      await prisma.notification.create({
        data: {
          userId,
          type: 'badge',
          title: 'üèÖ –ù–æ–≤—ã–π –±–µ–π–¥–∂!',
          message: `–í—ã –ø–æ–ª—É—á–∏–ª–∏ –±–µ–π–¥–∂ "${badge.name}"!`,
          link: '/level'
        }
      })
    }
  }
}

function checkBadgeCondition(user: any, condition: string): boolean {
  // –ü–∞—Ä—Å–∏–º —É—Å–ª–æ–≤–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "completedTasks >= 10")
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ
  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º true/false
}
```

---

## üìä –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ level/
‚îÇ       ‚îú‚îÄ‚îÄ calculate.ts          # –†–∞—Å—á–µ—Ç —É—Ä–æ–≤–Ω—è –∏–∑ XP
‚îÇ       ‚îú‚îÄ‚îÄ awardXP.ts            # –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ XP
‚îÇ       ‚îú‚îÄ‚îÄ recalculateLevel.ts   # –ü–µ—Ä–µ—Å—á–µ—Ç —É—Ä–æ–≤–Ω—è (—É–ª—É—á—à–∏—Ç—å)
‚îÇ       ‚îî‚îÄ‚îÄ types.ts              # –¢–∏–ø—ã –¥–ª—è —É—Ä–æ–≤–Ω–µ–π
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îî‚îÄ‚îÄ users/
‚îÇ           ‚îî‚îÄ‚îÄ me/
‚îÇ               ‚îî‚îÄ‚îÄ level/
‚îÇ                   ‚îî‚îÄ‚îÄ route.ts   # –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π API
‚îî‚îÄ‚îÄ components/
    ‚îî‚îÄ‚îÄ LevelProgress.tsx          # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —É—Ä–æ–≤–Ω—è
```

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### üî• –ö—Ä–∏—Ç–∏—á–Ω–æ (—Å–¥–µ–ª–∞—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å):
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å 'done' ‚Üí 'completed'
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ä–∞—Å—á–µ—Ç–∞ —É—Ä–æ–≤–Ω–µ–π
3. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—Ç—å XP –≤ –ë–î
4. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ XP –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏

### ‚ö° –í–∞–∂–Ω–æ (—Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø):
5. ‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ XP –ø—Ä–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
6. ‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ XP –ø—Ä–∏ –æ—Ç–∑—ã–≤–∞—Ö
7. ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –±–µ–π–¥–∂–µ–π –≤ API
8. ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è

### üí° –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –≤—Ä–µ–º—è):
9. ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ UI —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É—Ä–æ–≤–Ω—è
10. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±–µ–π–¥–∂–µ–π
11. ‚úÖ –ì—Ä–∞—Ñ–∏–∫ –∏—Å—Ç–æ—Ä–∏–∏ XP
12. ‚úÖ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
```typescript
// src/app/api/users/me/level/route.ts:26
- where: { executorId: user.id, status: 'done' }
+ where: { executorId: user.id, status: 'completed' }
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ XP –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏
```typescript
// src/app/api/tasks/[id]/complete/route.ts
import { awardXP } from '@/lib/level/awardXP'

// –ü–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 125 (–ø–æ—Å–ª–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –≤—ã–ø–ª–∞—Ç—ã –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é)
await prisma.user.update({
  where: { id: task.executorId },
  data: {
    balance: { increment: payoutDecimal },
    transactions: {
      create: {
        amount: payoutDecimal,
        type: 'earn',
        reason: `–í—ã–ø–ª–∞—Ç–∞ –∑–∞ –∑–∞–¥–∞—á—É "${task.title}"`,
      },
    },
  },
})

// ‚úÖ –î–û–ë–ê–í–ò–¢–¨:
if (task.executorId) {
  await awardXP(
    task.executorId,
    20, // +20 XP
    `–í—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞–¥–∞—á–∞ "${task.title}"`
  )
}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ XP –ø—Ä–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
```typescript
// src/app/api/cert/attempts/submit/route.ts
import { awardXP } from '@/lib/level/awardXP'

// –ü–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 78 (–ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
if (passed) {
  await prisma.userCertification.upsert({
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
  })
  
  // ‚úÖ –î–û–ë–ê–í–ò–¢–¨:
  await awardXP(
    user.id,
    10, // +10 XP
    `–ü—Ä–æ–π–¥–µ–Ω–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è`
  )
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:
1. ‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ +20 XP
2. ‚úÖ –ü—Ä–æ–π—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ +10 XP
3. ‚úÖ –ü–æ–ª—É—á–∏—Ç—å –æ—Ç–∑—ã–≤ 4+ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ +5 XP
4. ‚úÖ –ù–∞–±—Ä–∞—Ç—å 100 XP ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ XP –≤ –ë–î
7. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚ùå XP –Ω–µ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è
- ‚ùå –£—Ä–æ–≤–Ω–∏ –Ω–µ –ø–æ–≤—ã—à–∞—é—Ç—Å—è
- ‚ùå –î–≤–µ —Ä–∞–∑–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å—á–µ—Ç–∞
- ‚ùå –ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ XP
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π
- ‚úÖ –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–∑ –ë–î
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è—Ö
- ‚úÖ –ú–æ—Ç–∏–≤–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

*–°–æ–∑–¥–∞–Ω–æ: –î–µ–∫–∞–±—Ä—å 2025*

