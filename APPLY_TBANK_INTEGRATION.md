# ‚ö° –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¢-–ë–∞–Ω–∫ –ú—É–ª—å—Ç–∏—Ä–∞—Å—á–µ—Ç—ã

## üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª `.env` –≤ –ø–∞–ø–∫–µ `NESI/`:

```bash
# –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏ –≤ .env

# === –¢-–ë–∞–Ω–∫ –ú—É–ª—å—Ç–∏—Ä–∞—Å—á–µ—Ç—ã ===
TBANK_TERMINAL_KEY="TinkoffBankTest"
TBANK_TERMINAL_PASSWORD="–∑–∞–º–µ–Ω–∏—Ç–µ_–Ω–∞_–≤–∞—à_–ø–∞—Ä–æ–ª—å"
TBANK_E2C_TERMINAL_KEY="TerminalKeyE2C"
TBANK_E2C_TERMINAL_PASSWORD="–∑–∞–º–µ–Ω–∏—Ç–µ_–Ω–∞_–ø–∞—Ä–æ–ª—å_e2c"
TBANK_MODE="test"
```

**–ì–¥–µ –≤–∑—è—Ç—å —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**

- –ü–æ–¥–∞–π—Ç–µ –∑–∞—è–≤–∫—É –Ω–∞ [tbank.ru/kassa](https://tbank.ru/kassa)
- –£–∫–∞–∂–∏—Ç–µ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ú—É–ª—å—Ç–∏—Ä–∞—Å—á–µ—Ç–æ–≤"
- –ü–æ–ª—É—á–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ email

### 2Ô∏è‚É£ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
cd NESI

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
npx prisma migrate dev

# –ï—Å–ª–∏ —Å–ø—Ä–æ—Å–∏—Ç –∏–º—è –º–∏–≥—Ä–∞—Ü–∏–∏, –≤–≤–µ–¥–∏—Ç–µ:
# add_tbank_multisplit

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Prisma Client
npx prisma generate
```

**–ß—Ç–æ —Å–æ–∑–¥–∞—Å—Ç—Å—è –≤ –ë–î:**

- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `TBankDeal` (—Å–¥–µ–ª–∫–∏)
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `TBankPayment` (–ø–ª–∞—Ç–µ–∂–∏)
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `TBankPayout` (–≤—ã–ø–ª–∞—Ç—ã)
- ‚úÖ Enum `DealStatus` (—Å—Ç–∞—Ç—É—Å—ã —Å–¥–µ–ª–æ–∫)

### 3Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
npm install
```

–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã —É–∂–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ `package.json`.

### 4Ô∏è‚É£ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç

```bash
# –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev

# –ò–ª–∏ production
npm run build
npm start
```

### 5Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Webhook –≤ –¢-–ë–∞–Ω–∫–µ

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [business.tbank.ru](https://business.tbank.ru)
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
4. **Notification URL:** `https://nesi.su/api/tbank/webhook`

**–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** (–µ—Å–ª–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç–µ –¥–æ –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä):

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ø—É–±–ª–∏—á–Ω–æ–≥–æ URL
ngrok http 3000
# –ü–æ–ª—É—á–µ–Ω–Ω—ã–π URL (https://abc123.ngrok.io) –≤—Ä–µ–º–µ–Ω–Ω–æ —É–∫–∞–∂–∏—Ç–µ –∫–∞–∫ Notification URL
# –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–∞ nesi.su –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–º–µ–Ω–∏—Ç–µ –Ω–∞ https://nesi.su/api/tbank/webhook
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `NESI/test-tbank.js`:

```javascript
require('dotenv').config()

console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:')
console.log('TBANK_TERMINAL_KEY:', process.env.TBANK_TERMINAL_KEY ? '‚úÖ' : '‚ùå')
console.log(
	'TBANK_TERMINAL_PASSWORD:',
	process.env.TBANK_TERMINAL_PASSWORD ? '‚úÖ' : '‚ùå'
)
console.log(
	'TBANK_E2C_TERMINAL_KEY:',
	process.env.TBANK_E2C_TERMINAL_KEY ? '‚úÖ' : '‚ùå'
)
console.log(
	'TBANK_E2C_TERMINAL_PASSWORD:',
	process.env.TBANK_E2C_TERMINAL_PASSWORD ? '‚úÖ' : '‚ùå'
)
console.log('TBANK_MODE:', process.env.TBANK_MODE || 'test')
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
node test-tbank.js
```

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î

```bash
npx prisma studio
```

–û—Ç–∫—Ä–æ–µ—Ç—Å—è UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ë–î. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü:

- `TBankDeal`
- `TBankPayment`
- `TBankPayout`

### –¢–µ—Å—Ç 3: –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç: `npm run dev`
2. –û—Ç–∫—Ä–æ–π—Ç–µ `https://nesi.su/profile` (–∏–ª–∏ http://localhost:3000/profile –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É "–ö–æ—à–µ–ª–µ–∫"
4. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å"
5. –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É: **100**
6. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
7. –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Ñ–æ—Ä–º—É –¢-–ë–∞–Ω–∫–∞ –∏–ª–∏ –æ—à–∏–±–∫—É —Å –¥–µ—Ç–∞–ª—è–º–∏

### –¢–µ—Å—Ç 4: –¢–µ—Å—Ç–æ–≤—ã–π –≤—ã–≤–æ–¥

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤"
2. –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä: **+79066589133** (—Ç–µ—Å—Ç–æ–≤—ã–π)
3. –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É: **100**
4. –ù–∞–∂–º–∏—Ç–µ "–í—ã–≤–µ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞"
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

---

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –°–±—Ä–æ—Å–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (–í–ù–ò–ú–ê–ù–ò–ï: —É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ!)
npx prisma migrate reset

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∑–∞–Ω–æ–≤–æ
npx prisma migrate dev
```

### –û—à–∏–±–∫–∞ "Module not found"

```bash
# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
rm -rf node_modules package-lock.json
npm install
```

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `DATABASE_URL` –≤ `.env`:

```bash
DATABASE_URL="postgresql://user:password@localhost:5432/nesi?schema=public"
```

---

## üìû –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¢-–ë–∞–Ω–∫–∞

- üìß `acq_help@tbank.ru`
- üìö [developer.tbank.ru/docs](https://developer.tbank.ru/docs)

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–æ–º

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `npm run dev`
- –ò–∑—É—á–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ —Ñ–∞–π–ª–∞—Ö:
  - `TBANK_MULTISPLIT_INTEGRATION.md`
  - `TBANK_QUICK_START.md`

---

## ‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ env: **2 –º–∏–Ω—É—Ç—ã**
- –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î: **1 –º–∏–Ω—É—Ç–∞**
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook: **5 –º–∏–Ω—É—Ç**
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: **10 –º–∏–Ω—É—Ç**

**–ò—Ç–æ–≥–æ: ~20 –º–∏–Ω—É—Ç**

---

## üéä –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —É –≤–∞—Å –±—É–¥–µ—Ç:

- ‚úÖ –†–∞–±–æ—á–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¢-–ë–∞–Ω–∫–æ–º
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –∏ –≤—ã–ø–ª–∞—Ç—ã
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö! üöÄ
