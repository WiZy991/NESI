# üöÄ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ 322

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ?

–ü–∞—Ä–∞–º–µ—Ç—Ä `FinalPayout` —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∫ **—Å—Ç—Ä–æ–∫–∞ `"true"`** –≤–º–µ—Å—Ç–æ **boolean `true`**.

–≠—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ T-Bank A2C_V2 (—Å—Ç—Ä. 903).

---

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é (Windows)

### 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞:

```powershell
cd C:\Users\Perfercher\Desktop\nesi\NESI
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```powershell
git status
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

- `modified:   src/lib/tbank.ts`
- `modified:   test-signature.js`
- `new file:   –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_FINALPAYOUT_STRING.md`
- `new file:   –ö–ê–ö_–ü–†–ò–ú–ï–ù–ò–¢–¨_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï.md`

### 3. –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```powershell
git add .
git commit -m "fix: –∏–∑–º–µ–Ω–∏—Ç—å FinalPayout –Ω–∞ —Å—Ç—Ä–æ–∫—É –¥–ª—è T-Bank API (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ 322)"
```

### 4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:

```powershell
git push origin main
```

---

## üñ•Ô∏è –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ

### –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É:

```bash
ssh your-server
```

### –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥:

```bash
cd ~/nesi-app

# –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull origin main

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
npm run build

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å
sudo systemctl restart nesi-app.service

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
sudo systemctl status nesi-app.service
```

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

```bash
# –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
sudo journalctl -u nesi-app.service -f

# –ò–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫
sudo journalctl -u nesi-app.service -n 50 --no-pager
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 1. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–≤–µ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞:

1. –í–æ–π–¥–∏—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–∞–π—Ç–µ
2. –ù–∞–∂–º–∏—Ç–µ "–í—ã–≤–µ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞"
3. –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É (–º–∏–Ω–∏–º—É–º 100 ‚ÇΩ)
4. –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–±: **–°–ë–ü**
5. –ù–∞–∂–º–∏—Ç–µ "–í—ã–≤–µ—Å—Ç–∏"

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
sudo journalctl -u nesi-app.service --since "1 minute ago" --no-pager | grep -E "CREATE-WITHDRAWAL|TBANK|Success"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

```
üì§ [TBANK] –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≤—ã–ø–ª–∞—Ç—É: {
  "FinalPayout": "true",  // ‚Üê –¢–µ–ø–µ—Ä—å —Å—Ç—Ä–æ–∫–∞!
  ...
}

üì• [TBANK] –û—Ç–≤–µ—Ç –æ—Ç API: {
  success: true,  // ‚Üê ‚úÖ –£—Å–ø–µ—Ö!
  errorCode: '0',
  paymentId: 'XXXXXXXX'
}

‚úÖ [CREATE-WITHDRAWAL] –í—ã–ø–ª–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞
```

### 3. –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç:

- ‚úÖ –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–º–µ–Ω—å—à–∏–ª—Å—è
- ‚úÖ –í –ª–æ–≥–∞—Ö –Ω–µ—Ç –æ—à–∏–±–∫–∏ 322
- ‚úÖ PaymentId –ø–æ–ª—É—á–µ–Ω –æ—Ç T-Bank

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ–¥–ø–∏—Å—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

```bash
cd ~/nesi-app
node test-signature.js
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**

```
üîë –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏:
[
  'Amount',
  'DealId',
  'FinalPayout',  // ‚Üê –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
  ...
]

üîó –ö–æ–Ω–∫–∞—Ç–µ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞:
10000...true...  // ‚Üê –∑–Ω–∞—á–µ–Ω–∏–µ "true" –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞

üîê –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Token:
[32-—Å–∏–º–≤–æ–ª—å–Ω—ã–π —Ö–µ—à]

‚úÖ –ü–æ–¥–ø–∏—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ
```

---

## ‚ùó –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞

### –û—à–∏–±–∫–∞ –ø—Ä–∏ git push:

```powershell
# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ –ø–æ–¥—Ç—è–Ω—É—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull --rebase origin main
git push origin main
```

### –û—à–∏–±–∫–∞ –ø—Ä–∏ npm run build:

```bash
# –£–¥–∞–ª–∏—Ç–µ –∫–µ—à –∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ
rm -rf .next
npm run build
```

### –û—à–∏–±–∫–∞ 322 –≤—Å—ë –µ—â—ë –≤–æ–∑–Ω–∏–∫–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:

```bash
cd ~/nesi-app
git log -1 --oneline
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "fix: –∏–∑–º–µ–Ω–∏—Ç—å FinalPayout –Ω–∞ —Å—Ç—Ä–æ–∫—É..."
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª:

```bash
grep -A 2 "FinalPayout" src/lib/tbank.ts
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: requestBody.FinalPayout = 'true'
```

3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω:

```bash
sudo systemctl restart nesi-app.service
sudo systemctl status nesi-app.service
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø–æ–¥—Ä–æ–±–Ω–æ:**

   ```bash
   sudo journalctl -u nesi-app.service --since "5 minutes ago" --no-pager | grep -A 10 "CREATE-WITHDRAWAL"
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

   ```bash
   # –í —Ñ–∞–π–ª–µ .env.local –∏–ª–∏ .env
   grep TBANK_ .env.local
   ```

   –î–æ–ª–∂–Ω—ã –±—ã—Ç—å:

   - `TBANK_E2C_TERMINAL_KEY=1763372956356E2C`
   - `TBANK_E2C_PASSWORD=...` (–≤–∞—à –ø–∞—Ä–æ–ª—å E2C)

3. **–°–æ–∑–¥–∞–π—Ç–µ issue** —Å –ø–æ–ª–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏ –æ—à–∏–±–∫–∏

---

**–ì–æ—Ç–æ–≤–æ!** üéâ –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤—ã–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ –°–ë–ü –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å!
