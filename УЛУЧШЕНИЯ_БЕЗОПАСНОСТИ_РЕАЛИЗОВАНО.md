# ‚úÖ –£–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

## üéØ –ß—Ç–æ –±—ã–ª–æ —É–ª—É—á—à–µ–Ω–æ

### 1. ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å JWT —Ç–æ–∫–µ–Ω–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ–ª–∞–≥–∏ `SameSite: 'lax'` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç CSRF
- –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `setSecureCookie()` –≤ `src/lib/security.ts`
- –û–±–Ω–æ–≤–ª–µ–Ω—ã endpoints: `/api/auth/login` –∏ `/api/auth/verify-email`

### 2. ‚úÖ XSS –∑–∞—â–∏—Ç–∞ –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è
- –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `sanitizeText()` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫:
  - –°–æ–æ–±—â–µ–Ω–∏—è–º (`/api/messages/send`)
  - –ó–∞–≥–æ–ª–æ–≤–∫–∞–º –∏ –æ–ø–∏—Å–∞–Ω–∏—è–º –∑–∞–¥–∞—á (`/api/tasks`)
  - –ü—Ä–æ—Ñ–∏–ª—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`/api/profile`)
  - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (`/api/auth/register`)

### 3. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ magic bytes (—Å–∏–≥–Ω–∞—Ç—É—Ä —Ñ–∞–π–ª–æ–≤) –≤ `src/lib/fileValidation.ts`
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤:
  - `/api/upload/chat-file`
  - `/api/upload/avatar`
  - `/api/messages/send`
  - `/api/tasks` (–ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á)
  - `/api/profile` (–ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤–∞—Ç–∞—Ä–∞)

### 4. ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç path traversal
- –°–æ–∑–¥–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `isValidFileName()` –∏ `normalizeFileName()` –≤ `src/lib/security.ts`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –∑–∞–≥—Ä—É–∑–∫–∞–º —Ñ–∞–π–ª–æ–≤

### 5. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–µ security headers
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ `middleware.ts`:
  - `Content-Security-Policy` (CSP)
  - `Strict-Transport-Security` (HSTS) - —Ç–æ–ª—å–∫–æ –¥–ª—è HTTPS
  - `Permissions-Policy` (Feature Policy)
  - `Referrer-Policy` (–æ–±–Ω–æ–≤–ª–µ–Ω)

### 6. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `validateStringLength()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª–∏–Ω—ã –ø–æ–ª–µ–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫:
  - –ó–∞–≥–æ–ª–æ–≤–∫–∞–º –∑–∞–¥–∞—á (–º–∞–∫—Å 200 —Å–∏–º–≤–æ–ª–æ–≤)
  - –û–ø–∏—Å–∞–Ω–∏—è–º –∑–∞–¥–∞—á (–º–∞–∫—Å 5000 —Å–∏–º–≤–æ–ª–æ–≤)
  - –°–æ–æ–±—â–µ–Ω–∏—è–º (–º–∞–∫—Å 10000 —Å–∏–º–≤–æ–ª–æ–≤)
  - –ò–º–µ–Ω–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–º–∞–∫—Å 100 —Å–∏–º–≤–æ–ª–æ–≤)
  - –û–ø–∏—Å–∞–Ω–∏—è–º –ø—Ä–æ—Ñ–∏–ª–µ–π (–º–∞–∫—Å 1000 —Å–∏–º–≤–æ–ª–æ–≤)
  - –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è–º (–º–∞–∫—Å 200 —Å–∏–º–≤–æ–ª–æ–≤)

### 7. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –°–æ–∑–¥–∞–Ω `src/lib/errorHandler.ts` —Å –∫–ª–∞—Å—Å–æ–º `AppError`
- –§—É–Ω–∫—Ü–∏—è `handleApiError()` —Å–∫—Ä—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ Prisma –æ—à–∏–±–æ–∫

### 8. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è email –∏ –ø–∞—Ä–æ–ª–µ–π
- –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è email –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –ø–∞—Ä–æ–ª—è (6-128 —Å–∏–º–≤–æ–ª–æ–≤)
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### 9. ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ rate limiting –∫ Redis
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ Redis
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Redis

## üìÅ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

1. **`src/lib/security.ts`** - —É—Ç–∏–ª–∏—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
   - `setSecureCookie()` - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ cookie
   - `sanitizeText()` - –æ—á–∏—Å—Ç–∫–∞ –æ—Ç XSS
   - `validateStringLength()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã
   - `isValidFileName()` / `normalizeFileName()` - –∑–∞—â–∏—Ç–∞ –æ—Ç path traversal
   - `validateEmail()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è email

2. **`src/lib/fileValidation.ts`** - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤:
   - `validateFile()` - –ø–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å magic bytes
   - `checkFileSignature()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä
   - `getMimeTypeFromSignature()` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ

3. **`src/lib/errorHandler.ts`** - —É–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
   - `AppError` –∫–ª–∞—Å—Å
   - `handleApiError()` - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
   - `createErrorResponse()` - —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ —Å –æ—à–∏–±–∫–∞–º–∏

## üîí –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫

- ‚úÖ **XSS** - —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **Path Traversal** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤
- ‚úÖ **CSRF** - SameSite cookie —Ñ–ª–∞–≥–∏
- ‚úÖ **File Upload Attacks** - –ø—Ä–æ–≤–µ—Ä–∫–∞ magic bytes –∏ —Ç–∏–ø–æ–≤
- ‚úÖ **SQL Injection** - Prisma –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—â–∏—â–∞–µ—Ç
- ‚úÖ **Brute Force** - rate limiting –Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
- ‚úÖ **Data Overflow** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã –≤—Å–µ—Ö –ø–æ–ª–µ–π

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **CSRF —Ç–æ–∫–µ–Ω—ã** - –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫)
2. **Zod —Å—Ö–µ–º—ã** - –¥–ª—è –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤
3. **Redis –¥–ª—è rate limiting** - –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ
4. **2FA** - –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
5. **–ê—É–¥–∏—Ç –ª–æ–≥–æ–≤** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º
- –ê–¥–º–∏–Ω–∫–∞ –Ω–µ –±—ã–ª–∞ –∑–∞—Ç—Ä–æ–Ω—É—Ç–∞ (–∫–∞–∫ –ø—Ä–æ—Å–∏–ª–∏)
- –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ —Å–∫—Ä—ã—Ç—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- Magic bytes –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–º–æ–≥–∞–µ—Ç –≤—ã—è–≤–ª—è—Ç—å –ø–æ–¥–¥–µ–ª–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

---

**–î–∞—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** 2025
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

