# üîß –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –≤ –∞–¥–º–∏–Ω–∫–µ

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ `/admin/feedback` –æ—à–∏–±–∫–∞ **403 Forbidden** - "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω"

## üêõ –ü—Ä–∏—á–∏–Ω–∞
–í JWT —Ç–æ–∫–µ–Ω–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∞—Å—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ–≤–µ—Ä–∫–∞ `payload.role !== 'admin'` –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∞.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```bash
cd /home/nesi/nesi-app
git pull
npm run build
pm2 restart nesi-app
```

### 2. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!** –†–∞–∑–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å –∏ –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞
–í–∞–∂–Ω–æ: —Å—Ç–∞—Ä—ã–π —Ç–æ–∫–µ–Ω –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–æ–ª—å, –Ω—É–∂–µ–Ω –Ω–æ–≤—ã–π!

1. –ù–∞–∂–º–∏—Ç–µ "–í—ã–π—Ç–∏" –≤ –º–µ–Ω—é
2. –í–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞
3. –û—Ç–∫—Ä–æ–π—Ç–µ `/admin/feedback`

### 3. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
pm2 logs nesi-app --lines 50 | grep feedback
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ
‚úÖ –ü–æ–ª—É—á–µ–Ω–æ X –æ—Ç–∑—ã–≤–æ–≤
```

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:
```
‚ùå –ù–µ –∞–¥–º–∏–Ω. –†–æ–ª—å: user
```
‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–¥–º–∏–Ω, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ role –≤ –ë–î

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î
```sql
SELECT id, email, role FROM "User" WHERE email = 'your@email.com';
```

–†–æ–ª—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å `admin`.

## üéØ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –ë—ã–ª–æ:
```typescript
signJWT({ userId: user.id }) // ‚ùå –†–æ–ª—å –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
```

### –°—Ç–∞–ª–æ:
```typescript
signJWT({ userId: user.id, role: user.role }) // ‚úÖ –†–æ–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
```

### Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤:
```typescript
let userRole = (payload as any).role
if (!userRole) {
  const user = await prisma.user.findUnique({
    where: { id: userId },
    select: { role: true },
  })
  userRole = user?.role
}
```

## ‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –ù–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —Ä–æ–ª—å
- –°—Ç–∞—Ä—ã–µ —Ç–æ–∫–µ–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ fallback –∫ –ë–î
- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –±–µ–∑ 403

