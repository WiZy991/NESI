# üè¶ –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¢-–ë–∞–Ω–∫–∞ (T-Bank Acquiring)

**–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –¢-–ë–∞–Ω–∫–∞ –∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ NESI**

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º

- [ ] –ü–æ–ª—É—á–µ–Ω–æ –æ–¥–æ–±—Ä–µ–Ω–∏–µ –æ—Ç –¢-–ë–∞–Ω–∫–∞
- [ ] –ï—Å—Ç—å –¥–æ—Å—Ç—É–ø—ã –∫ API (TerminalKey –∏ Password)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –Ω–∞ t.me/tbusiness_bot
- [ ] –£–∫–∞–∑–∞–Ω callback URL –¥–ª—è –≤–µ–±—Ö—É–∫–∞

---

## üöÄ –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ npm –ø–∞–∫–µ—Ç–∞

```bash
npm install @tinkoff/acquiring-sdk
# –∏–ª–∏
npm install axios # –¥–ª—è —Ä—É—á–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
```

---

## üîß –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¢-–ë–∞–Ω–∫–æ–º

**–§–∞–π–ª:** `src/lib/tbank.ts`

```typescript
/**
 * –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å T-Bank Acquiring API
 * –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://www.tbank.ru/kassa/dev/
 */

const TBANK_API_URL = 'https://securepay.tinkoff.ru/v2'

interface CreatePaymentParams {
  amount: number // –°—É–º–º–∞ –≤ —Ä—É–±–ª—è—Ö
  orderId: string // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∑–∞–∫–∞–∑–∞
  description: string
  customerEmail?: string
}

interface PaymentResponse {
  Success: boolean
  ErrorCode?: string
  Message?: string
  TerminalKey: string
  Amount: number
  OrderId: string
  PaymentId: string
  PaymentURL: string
  Status: string
}

/**
 * –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –≤ –¢-–ë–∞–Ω–∫–µ
 */
export async function createTBankPayment(params: CreatePaymentParams): Promise<PaymentResponse> {
  const terminalKey = process.env.TBANK_TERMINAL_KEY
  const password = process.env.TBANK_PASSWORD

  if (!terminalKey || !password) {
    throw new Error('T-Bank credentials not configured')
  }

  const body = {
    TerminalKey: terminalKey,
    Amount: Math.round(params.amount * 100), // –ö–æ–ø–µ–π–∫–∏
    OrderId: params.orderId,
    Description: params.description,
    NotificationURL: `${process.env.NEXT_PUBLIC_APP_URL}/api/wallet/tbank/webhook`,
    SuccessURL: `${process.env.NEXT_PUBLIC_APP_URL}/wallet/payment-success`,
    FailURL: `${process.env.NEXT_PUBLIC_APP_URL}/wallet/payment-failed`,
  }

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ (–¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∑–∞–ø—Ä–æ—Å–∞)
  const token = generateToken({ ...body, Password: password })

  const response = await fetch(`${TBANK_API_URL}/Init`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ ...body, Token: token }),
  })

  const data = await response.json()

  if (!data.Success) {
    throw new Error(data.Message || 'Failed to create payment')
  }

  return data
}

/**
 * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞
 */
export async function checkTBankPayment(paymentId: string): Promise<PaymentResponse> {
  const terminalKey = process.env.TBANK_TERMINAL_KEY
  const password = process.env.TBANK_PASSWORD

  const body = {
    TerminalKey: terminalKey,
    PaymentId: paymentId,
  }

  const token = generateToken({ ...body, Password: password })

  const response = await fetch(`${TBANK_API_URL}/GetState`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ ...body, Token: token }),
  })

  const data = await response.json()
  return data
}

/**
 * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∑–∞–ø—Ä–æ—Å–∞
 * –ê–ª–≥–æ—Ä–∏—Ç–º: SHA-256 –æ—Ç –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
 */
function generateToken(params: Record<string, any>): string {
  const crypto = require('crypto')
  
  // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–ª—é—á–∏
  const sorted = Object.keys(params)
    .sort()
    .filter(key => params[key] !== undefined && params[key] !== null && params[key] !== '')
    .map(key => params[key])
    .join('')

  return crypto.createHash('sha256').update(sorted).digest('hex')
}

/**
 * –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –≤–µ–±—Ö—É–∫–∞ –æ—Ç –¢-–ë–∞–Ω–∫–∞
 */
export function verifyWebhookSignature(body: any, receivedToken: string): boolean {
  const password = process.env.TBANK_PASSWORD
  const expectedToken = generateToken({ ...body, Password: password })
  return expectedToken === receivedToken
}

/**
 * –ü–∞—Ä—Å–∏–Ω–≥ —Å—É–º–º—ã –∏–∑ –∫–æ–ø–µ–µ–∫ –≤ —Ä—É–±–ª–∏
 */
export function parseTBankAmount(amount: number): number {
  return amount / 100
}
```

---

## üåê –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å API —Ä–æ—É—Ç—ã

### 3.1 –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

**–§–∞–π–ª:** `src/app/api/wallet/tbank/create-payment/route.ts`

```typescript
import { getUserFromRequest } from '@/lib/auth'
import { createTBankPayment } from '@/lib/tbank'
import { NextRequest, NextResponse } from 'next/server'

export async function POST(req: NextRequest) {
  try {
    const user = await getUserFromRequest(req)
    if (!user) {
      return NextResponse.json({ error: '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' }, { status: 401 })
    }

    const { amount } = await req.json()

    if (!amount || amount < 100 || amount > 300000) {
      return NextResponse.json(
        { error: '–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 100 –¥–æ 300,000 ‚ÇΩ' },
        { status: 400 }
      )
    }

    // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∑–∞–∫–∞–∑–∞
    const orderId = `deposit_${user.id}_${Date.now()}`

    // –°–æ–∑–¥–∞–µ–º –ø–ª–∞—Ç–µ–∂ –≤ –¢-–ë–∞–Ω–∫–µ
    const payment = await createTBankPayment({
      amount,
      orderId,
      description: `–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ NESI`,
      customerEmail: user.email,
    })

    return NextResponse.json({
      paymentId: payment.PaymentId,
      paymentUrl: payment.PaymentURL,
      amount: payment.Amount / 100,
    })
  } catch (error: any) {
    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ T-Bank:', error)
    return NextResponse.json(
      { error: error.message || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞' },
      { status: 500 }
    )
  }
}
```

### 3.2 –í–µ–±—Ö—É–∫ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–§–∞–π–ª:** `src/app/api/wallet/tbank/webhook/route.ts`

```typescript
import prisma from '@/lib/prisma'
import { parseTBankAmount, verifyWebhookSignature } from '@/lib/tbank'
import { Prisma } from '@prisma/client'
import { NextRequest, NextResponse } from 'next/server'

export async function POST(req: NextRequest) {
  try {
    const body = await req.json()
    console.log('üì• –í–µ–±—Ö—É–∫ –æ—Ç T-Bank:', body)

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å—å
    if (!verifyWebhookSignature(body, body.Token)) {
      console.error('‚ö†Ô∏è –ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å –≤–µ–±—Ö—É–∫–∞')
      return NextResponse.json({ error: 'Invalid signature' }, { status: 403 })
    }

    const { Status, PaymentId, OrderId, Amount } = body

    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
    if (Status !== 'CONFIRMED') {
      console.log(`‚è≥ –ü–ª–∞—Ç–µ–∂ ${PaymentId} –≤ —Å—Ç–∞—Ç—É—Å–µ ${Status}, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º`)
      return NextResponse.json({ ok: true })
    }

    // –ò–∑–≤–ª–µ–∫–∞–µ–º userId –∏–∑ OrderId (—Ñ–æ—Ä–º–∞—Ç: deposit_userId_timestamp)
    const userId = OrderId.split('_')[1]
    if (!userId) {
      console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å userId –∏–∑ OrderId:', OrderId)
      return NextResponse.json({ error: 'Invalid OrderId' }, { status: 400 })
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –ª–∏ —É–∂–µ —ç—Ç–æ—Ç –ø–ª–∞—Ç–µ–∂
    const existingTx = await prisma.transaction.findFirst({
      where: {
        reason: { contains: PaymentId },
      },
    })

    if (existingTx) {
      console.log('‚úÖ –ü–ª–∞—Ç–µ–∂ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω:', PaymentId)
      return NextResponse.json({ ok: true, alreadyProcessed: true })
    }

    // –ù–∞—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    const amount = parseTBankAmount(Amount)
    const amountDecimal = new Prisma.Decimal(amount)

    await prisma.user.update({
      where: { id: userId },
      data: {
        balance: { increment: amountDecimal },
        transactions: {
          create: {
            amount: amountDecimal,
            type: 'tbank_deposit',
            reason: `–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –¢-–ë–∞–Ω–∫ (ID: ${PaymentId})`,
            status: 'completed',
          },
        },
      },
    })

    console.log(`‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–æ ${amount} ‚ÇΩ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${userId}`)

    return NextResponse.json({ ok: true })
  } catch (error: any) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–∞ T-Bank:', error)
    return NextResponse.json({ error: 'Internal error' }, { status: 500 })
  }
}
```

---

## üé® –®–∞–≥ 4: –î–æ–±–∞–≤–∏—Ç—å UI –≤ –ø—Ä–æ—Ñ–∏–ª—å

**–§–∞–π–ª:** `src/app/profile/ProfilePageContent.tsx`

–î–æ–±–∞–≤—å—Ç–µ –ø–æ—Å–ª–µ –±–ª–æ–∫–∞ —Å –±–∞–ª–∞–Ω—Å–æ–º:

```typescript
const [isDepositModalOpen, setIsDepositModalOpen] = useState(false)
const [depositAmount, setDepositAmount] = useState(1000)

const handleDeposit = async () => {
  if (depositAmount < 100 || depositAmount > 300000) {
    alert('–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 100 –¥–æ 300,000 ‚ÇΩ')
    return
  }

  try {
    const res = await fetch('/api/wallet/tbank/create-payment', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${token}`,
      },
      body: JSON.stringify({ amount: depositAmount }),
    })

    const data = await res.json()

    if (!res.ok) {
      alert(data.error || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞')
      return
    }

    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã –¢-–ë–∞–Ω–∫–∞
    window.location.href = data.paymentUrl
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞:', error)
    alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂')
  }
}

// –í JSX –¥–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É:
<button
  onClick={() => setIsDepositModalOpen(true)}
  className="px-4 py-2 rounded border border-emerald-400 text-emerald-400 hover:bg-emerald-400 hover:text-black transition"
>
  üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ –¢-–ë–∞–Ω–∫
</button>

{/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
{isDepositModalOpen && (
  <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80">
    <div className="bg-[#001410] border border-emerald-500/40 rounded-2xl p-6 max-w-md w-full">
      <h3 className="text-xl font-bold text-emerald-400 mb-4">
        –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
      </h3>
      <input
        type="number"
        value={depositAmount}
        onChange={(e) => setDepositAmount(parseInt(e.target.value) || 0)}
        className="w-full bg-transparent border border-emerald-500/30 text-white p-3 rounded mb-4"
        placeholder="–°—É–º–º–∞ (‚ÇΩ)"
        min={100}
        max={300000}
      />
      <div className="flex gap-3">
        <button
          onClick={handleDeposit}
          className="flex-1 px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white rounded"
        >
          –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
        </button>
        <button
          onClick={() => setIsDepositModalOpen(false)}
          className="px-4 py-2 border border-gray-600 text-gray-400 rounded"
        >
          –û—Ç–º–µ–Ω–∞
        </button>
      </div>
    </div>
  </div>
)}
```

---

## üîê –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–§–∞–π–ª:** `.env` –∏–ª–∏ `.env.local`

```bash
# T-Bank Acquiring
TBANK_TERMINAL_KEY=–≤–∞—à_terminal_key
TBANK_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å

# URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
NEXT_PUBLIC_APP_URL=https://nesi.ru

# ID –≤–ª–∞–¥–µ–ª—å—Ü–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (–¥–ª—è –∫–æ–º–∏—Å—Å–∏–π)
PLATFORM_OWNER_ID=id_–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
```

---

## üìÑ –®–∞–≥ 6: –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### –£—Å–ø–µ—Ö

**–§–∞–π–ª:** `src/app/wallet/payment-success/page.tsx`

```typescript
'use client'

import Link from 'next/link'

export default function PaymentSuccessPage() {
  return (
    <div className="min-h-screen flex items-center justify-center px-4">
      <div className="max-w-md w-full bg-black/40 border border-emerald-500/30 rounded-2xl p-8 text-center">
        <div className="text-6xl mb-4">‚úÖ</div>
        <h1 className="text-2xl font-bold text-emerald-400 mb-4">
          –ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω!
        </h1>
        <p className="text-gray-300 mb-6">
          –°—Ä–µ–¥—Å—Ç–≤–∞ –ø–æ—Å—Ç—É–ø—è—Ç –Ω–∞ –≤–∞—à –±–∞–ª–∞–Ω—Å –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–∏–Ω—É—Ç.
        </p>
        <Link
          href="/profile"
          className="inline-block px-6 py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-lg"
        >
          –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª—å
        </Link>
      </div>
    </div>
  )
}
```

### –ù–µ—É–¥–∞—á–∞

**–§–∞–π–ª:** `src/app/wallet/payment-failed/page.tsx`

```typescript
'use client'

import Link from 'next/link'

export default function PaymentFailedPage() {
  return (
    <div className="min-h-screen flex items-center justify-center px-4">
      <div className="max-w-md w-full bg-black/40 border border-red-500/30 rounded-2xl p-8 text-center">
        <div className="text-6xl mb-4">‚ùå</div>
        <h1 className="text-2xl font-bold text-red-400 mb-4">
          –û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã
        </h1>
        <p className="text-gray-300 mb-6">
          –ü–ª–∞—Ç—ë–∂ –Ω–µ –±—ã–ª –∑–∞–≤–µ—Ä—à—ë–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.
        </p>
        <Link
          href="/profile"
          className="inline-block px-6 py-3 bg-red-600 hover:bg-red-500 text-white rounded-lg"
        >
          –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª—å
        </Link>
      </div>
    </div>
  )
}
```

---

## ‚úÖ –®–∞–≥ 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –¢-–ë–∞–Ω–∫–∞:

1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª
2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–æ—Å—Ç—É–ø—ã
3. –£–∫–∞–∂–∏—Ç–µ callback URL: `https://–≤–∞—à-–¥–æ–º–µ–Ω.ru/api/wallet/tbank/webhook`

### –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã –¢-–ë–∞–Ω–∫–∞:

- **–£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂:** `4300000000000777`
- **–û—Ç–∫–ª–æ–Ω—ë–Ω:** `4300000000000053`
- CVV: –ª—é–±–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `123`)
- –°—Ä–æ–∫: –ª—é–±–æ–π –±—É–¥—É—â–∏–π

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∞:

```bash
# 1. –õ–æ–∫–∞–ª—å–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
npm run dev

# 2. –û—Ç–∫—Ä—ã—Ç—å ngrok –¥–ª—è –≤–µ–±—Ö—É–∫–∞ (–µ—Å–ª–∏ –Ω–∞ localhost)
ngrok http 3000

# 3. –£–∫–∞–∑–∞—Ç—å ngrok URL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –¢-–ë–∞–Ω–∫–∞
# https://xxxx-xx-xxx-xxx-xxx.ngrok.io/api/wallet/tbank/webhook

# 4. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ UI
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –õ–æ–≥–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

```typescript
// –í –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
üì• –í–µ–±—Ö—É–∫ –æ—Ç T-Bank: { Status: 'CONFIRMED', ... }
‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–æ 1000 ‚ÇΩ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é abc123
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å
SELECT id, email, balance FROM "User" WHERE id = 'user_id';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
SELECT * FROM "Transaction" 
WHERE "userId" = 'user_id' 
ORDER BY "createdAt" DESC 
LIMIT 5;
```

---

## üéØ –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `src/lib/tbank.ts` —Å–æ–∑–¥–∞–Ω–∞
- [ ] API —Ä–æ—É—Ç `/api/wallet/tbank/create-payment` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] API —Ä–æ—É—Ç `/api/wallet/tbank/webhook` –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] UI –∫–Ω–æ–ø–∫–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –ø—Ä–æ—Ñ–∏–ª—å
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü—ã success/failed —Å–æ–∑–¥–∞–Ω—ã
- [ ] Callback URL —É–∫–∞–∑–∞–Ω –≤ –¢-–ë–∞–Ω–∫–µ
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂ –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ
- [ ] –°—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¢-–ë–∞–Ω–∫–∞:** https://www.tbank.ru/kassa/dev/
- **Telegram –±–æ—Ç:** @tbusiness_bot
- **Email:** business@tbank.ru

---

**–í—Ä–µ–º—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:** ~2-4 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞:** 95% (–æ—Å—Ç–∞–ª—Å—è —Ç–æ–ª—å–∫–æ –¢-–ë–∞–Ω–∫)

üöÄ **–£–¥–∞—á–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π!**

