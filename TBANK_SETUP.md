# üè¶ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¢-–ë–∞–Ω–∫ –ú—É–ª—å—Ç–∏—Ä–∞—Å—á–µ—Ç—ã

## üìã –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

‚úÖ **–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞** —á–µ—Ä–µ–∑ –¢-–ë–∞–Ω–∫

- –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ API
- –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –ø–ª–∞—Ç–µ–∂–Ω—É—é —Ñ–æ—Ä–º—É –¢-–ë–∞–Ω–∫–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ —á–µ—Ä–µ–∑ –≤–µ–±—Ö—É–∫

‚úÖ **–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤** —á–µ—Ä–µ–∑ –¢-–ë–∞–Ω–∫

- –°–æ–∑–¥–∞–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã –Ω–∞ –∫–∞—Ä—Ç—É –∏–ª–∏ —á–µ—Ä–µ–∑ –°–ë–ü
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –∞–Ω—Ç–∏—Ñ—Ä–æ–¥–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ —Å –±–∞–ª–∞–Ω—Å–∞

‚úÖ **–í–µ–±—Ö—É–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∞**

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–π –æ—Ç –¢-–ë–∞–Ω–∫–∞
- –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `.env` –∏–ª–∏ `.env.local`:

```env
# –¢-–ë–∞–Ω–∫ API (–¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è)
TBANK_TERMINAL_KEY=–≤–∞—à_terminal_key
TBANK_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å

# –¢-–ë–∞–Ω–∫ E2C API (–¥–ª—è –≤—ã–ø–ª–∞—Ç)
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ç–æ—Ç –∂–µ —Ç–µ—Ä–º–∏–Ω–∞–ª, –º–æ–∂–Ω–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å
TBANK_E2C_TERMINAL_KEY=–≤–∞—à_e2c_terminal_key

# URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –∏ –≤–µ–±—Ö—É–∫–æ–≤)
NEXT_PUBLIC_APP_URL=https://–≤–∞—à-–¥–æ–º–µ–Ω.ru
# –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
# NEXT_PUBLIC_APP_URL=http://localhost:3000

# –û–∫—Ä—É–∂–µ–Ω–∏–µ (production/test)
NODE_ENV=production
```

## üîê –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–µ–π

1. **–ü–æ–¥–∞–π—Ç–µ –∑–∞—è–≤–∫—É** –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ú—É–ª—å—Ç–∏—Ä–∞—Å—á–µ—Ç–æ–≤:

   - –ß–µ—Ä–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
   - –ò–ª–∏ –Ω–∞ —Å–∞–π—Ç–µ: https://tbank.ru/kassa
   - –£–∫–∞–∂–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—Ä–æ–∫ —Å–¥–µ–ª–∫–∏

2. **–ü–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø—ã:**

   - `TerminalKey` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
   - `Password` - –ø–∞—Ä–æ–ª—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Token
   - `E2C TerminalKey` - –¥–ª—è –≤—ã–ø–ª–∞—Ç (–º–æ–∂–µ—Ç —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –æ—Å–Ω–æ–≤–Ω—ã–º)

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–µ–±—Ö—É–∫** –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –¢-–ë–∞–Ω–∫–∞:
   - URL: `https://–≤–∞—à-–¥–æ–º–µ–Ω.ru/api/wallet/tbank/webhook`
   - –ú–µ—Ç–æ–¥: POST
   - –§–æ—Ä–º–∞—Ç: JSON

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend

- `src/lib/tbank.ts` - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API –¢-–ë–∞–Ω–∫–∞
- `src/app/api/wallet/tbank/create-payment/route.ts` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
- `src/app/api/wallet/tbank/create-withdrawal/route.ts` - —Å–æ–∑–¥–∞–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã
- `src/app/api/wallet/tbank/webhook/route.ts` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤

### Frontend

- `src/app/profile/ProfilePageContent.tsx` - –æ–±–Ω–æ–≤–ª–µ–Ω UI –∫–æ—à–µ–ª—å–∫–∞
- `src/app/wallet/payment-success/page.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
- `src/app/wallet/payment-failed/page.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—à–∏–±–∫–∏ –æ–ø–ª–∞—Ç—ã

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å ‚Üí –≤–∫–ª–∞–¥–∫–∞ "–ö–æ—à–µ–ª—ë–∫"
2. –ù–∞–∂–∏–º–∞–µ—Ç "–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å —á–µ—Ä–µ–∑ –¢-–ë–∞–Ω–∫"
3. –í–≤–æ–¥–∏—Ç —Å—É–º–º—É (–æ—Ç 1 ‚ÇΩ –¥–æ 300,000 ‚ÇΩ)
4. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –ø–ª–∞—Ç–µ–∂–Ω—É—é —Ñ–æ—Ä–º—É –¢-–ë–∞–Ω–∫–∞
5. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ —Å–∞–π—Ç
6. –°—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –≤–µ–±—Ö—É–∫

### –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Å—É–º–º—É –≤—ã–≤–æ–¥–∞ (–º–∏–Ω–∏–º—É–º 100 ‚ÇΩ)
2. –ù–∞–∂–∏–º–∞–µ—Ç "–í—ã–≤–µ—Å—Ç–∏"
3. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–ª–∞–Ω—Å –∏ –∞–Ω—Ç–∏—Ñ—Ä–æ–¥ –ø—Ä–∞–≤–∏–ª–∞
4. –°–æ–∑–¥–∞–µ—Ç—Å—è –≤—ã–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –¢-–ë–∞–Ω–∫ API
5. –°—Ä–µ–¥—Å—Ç–≤–∞ —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Å –±–∞–ª–∞–Ω—Å–∞
6. –í—ã–ø–ª–∞—Ç–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –±–∞–Ω–∫–æ–º

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –î–ª—è –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç DealId –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è.**

–í —Å–∏—Å—Ç–µ–º–µ –ú—É–ª—å—Ç–∏—Ä–∞—Å—á–µ—Ç–æ–≤:

- –ö–∞–∂–¥–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–æ–∑–¥–∞–µ—Ç —Å–¥–µ–ª–∫—É (DealId)
- –í—ã–ø–ª–∞—Ç—ã –≤–æ–∑–º–æ–∂–Ω—ã —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–¥–µ–ª–∫–∏
- –°—É–º–º–∞ –≤—ã–ø–ª–∞—Ç—ã –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å –æ—Å—Ç–∞—Ç–æ–∫ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ —Å–¥–µ–ª–∫–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:**

1. –°–æ—Ö—Ä–∞–Ω—è—Ç—å DealId –ø—Ä–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
2. –°–≤—è–∑—ã–≤–∞—Ç—å DealId —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
3. –ü—Ä–∏ –≤—ã–≤–æ–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π DealId
4. –ò–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Å–¥–µ–ª–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã –¢-–ë–∞–Ω–∫–∞:**

- –£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂: `4300000000000777`
- –û—Ç–∫–ª–æ–Ω—ë–Ω: `4300000000000053`
- CVV: –ª—é–±–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `123`)
- –°—Ä–æ–∫: –ª—é–±–∞—è –±—É–¥—É—â–∞—è –¥–∞—Ç–∞

**–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞:**

- URL: `https://rest-api-test.tinkoff.ru`
- –î–ª—è –¥–æ—Å—Ç—É–ø–∞ —Å IP –≤–Ω–µ –†–§ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞ `acq_help@tbank.ru`

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –õ–æ–≥–∏

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:

```bash
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è:
üì• –í–µ–±—Ö—É–∫ –æ—Ç T-Bank: { Status: 'CONFIRMED', ... }
‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–æ 1000 ‚ÇΩ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é abc123
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:

```sql
SELECT * FROM "Transaction"
WHERE "reason" LIKE '%–¢-–ë–∞–Ω–∫%'
ORDER BY "createdAt" DESC
LIMIT 10;
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¢-–ë–∞–Ω–∫–∞:** https://www.tbank.ru/kassa/dev/
- **–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞:** acq_help@tbank.ru
- **Telegram –±–æ—Ç:** @tbusiness_bot

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] TerminalKey –∏ Password –ø–æ–ª—É—á–µ–Ω—ã
- [ ] –í–µ–±—Ö—É–∫ URL —É–∫–∞–∑–∞–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –¢-–ë–∞–Ω–∫–∞
- [ ] **–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –ø—Ä–∏–º–µ–Ω–µ–Ω–∞** (–¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è dealId –∏ paymentId)
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂ –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ
- [ ] –°—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å
- [ ] –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç DealId)
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DealId

DealId —Ç–µ–ø–µ—Ä—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏! –°–º. –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ [TBANK_DEALID_SETUP.md](./TBANK_DEALID_SETUP.md)

**–í–∞–∂–Ω–æ:** –ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î:

```bash
npx prisma migrate dev --name add_tbank_deal_payment_ids
```

---

**–í—Ä–µ–º—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:** ~2-3 —á–∞—Å–∞  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
