# üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –¢-–ë–∞–Ω–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –î–µ–Ω—å–≥–∏ –ø–æ—Å—Ç—É–ø–∏–ª–∏ –≤ –¢-–ë–∞–Ω–∫, –Ω–æ –Ω–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. **–í–µ–±—Ö—É–∫ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä**
2. **–í–µ–±—Ö—É–∫ –ø—Ä–∏—Ö–æ–¥–∏—Ç, –Ω–æ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è (–æ—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∏)**
3. **–í–µ–±—Ö—É–∫ –ø—Ä–∏—Ö–æ–¥–∏—Ç, –Ω–æ –ø–ª–∞—Ç–µ–∂ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Å—Ç–∞—Ç—É—Å–µ**
4. **–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –ë–î**

## üîç –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø–∏—Å–µ–π –æ—Ç –≤–µ–±—Ö—É–∫–∞:

```bash
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ PM2
pm2 logs

# –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
tail -f logs/app.log
```

–ò—â–∏—Ç–µ –∑–∞–ø–∏—Å–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[WEBHOOK]`:

- `üì• [WEBHOOK] –í—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å –æ—Ç T-Bank` - –≤–µ–±—Ö—É–∫ –ø–æ–ª—É—á–µ–Ω
- `üîê [WEBHOOK] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
- `üí∞ [WEBHOOK] –ù–∞—á–∏–Ω–∞–µ–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ` - –Ω–∞—á–∞–ª–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
- `‚úÖ [WEBHOOK] –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ` - —É—Å–ø–µ—à–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ

## üîç –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–µ–±—Ö—É–∫–∞ –≤ –¢-–ë–∞–Ω–∫–µ

1. –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –¢-–ë–∞–Ω–∫–∞
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤–µ–±—Ö—É–∫–∞:
   ```
   https://–≤–∞—à-–¥–æ–º–µ–Ω.ru/api/wallet/tbank/webhook
   ```
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–µ–±—Ö—É–∫ –≤–∫–ª—é—á–µ–Ω –∏ –∞–∫—Ç–∏–≤–µ–Ω

## üîç –®–∞–≥ 3: –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–∞

–ï—Å–ª–∏ –≤–µ–±—Ö—É–∫ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä—É—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:

### –ß–µ—Ä–µ–∑ UI:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å ‚Üí –≤–∫–ª–∞–¥–∫–∞ "–ö–æ—à–µ–ª—ë–∫"
2. –ï—Å–ª–∏ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ "üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–ª–∞—Ç–µ–∂" - –Ω–∞–∂–º–∏—Ç–µ –µ—ë
3. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ –∏ –Ω–∞—á–∏—Å–ª–∏—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞

### –ß–µ—Ä–µ–∑ API:

```bash
curl -X POST https://–≤–∞—à-–¥–æ–º–µ–Ω.ru/api/wallet/tbank/check-payment \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"paymentId": "YOUR_PAYMENT_ID"}'
```

## üîç –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å –≤–∞—à–∏–º PaymentId:

```sql
SELECT * FROM "Transaction"
WHERE "paymentId" = 'YOUR_PAYMENT_ID'
   OR "reason" LIKE '%YOUR_PAYMENT_ID%';
```

–ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ—Ç - –≤–µ–±—Ö—É–∫ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª—Å—è.

## üîç –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –≤–µ–±—Ö—É–∫–∞

–ï—Å–ª–∏ –≤–µ–±—Ö—É–∫ –ø—Ä–∏—Ö–æ–¥–∏—Ç, –Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 403:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `TBANK_PASSWORD`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞—Ä–æ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ `‚ö†Ô∏è [WEBHOOK] –ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å`

## üîç –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞

–í–µ–±—Ö—É–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–ª–∞—Ç–µ–∂–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `CONFIRMED`.

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ API:

```bash
curl -X POST https://securepay.tinkoff.ru/v2/GetState \
  -H "Content-Type: application/json" \
  -d '{
    "TerminalKey": "YOUR_TERMINAL_KEY",
    "PaymentId": "YOUR_PAYMENT_ID",
    "Token": "GENERATED_TOKEN"
  }'
```

## üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ: –†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ, –º–æ–∂–Ω–æ –Ω–∞—á–∏—Å–ª–∏—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ –≤—Ä—É—á–Ω—É—é:

1. –ù–∞–π–¥–∏—Ç–µ PaymentId –∏–∑ –ª–æ–≥–æ–≤ –∏–ª–∏ –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ –¢-–ë–∞–Ω–∫–∞
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ API `/api/wallet/tbank/check-payment`
3. –ò–ª–∏ –Ω–∞—á–∏—Å–ª–∏—Ç–µ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ –ë–î (—Ç–æ–ª—å–∫–æ –¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤):

```sql
-- –í–ù–ò–ú–ê–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–æ—á–Ω–æ —É–≤–µ—Ä–µ–Ω—ã!
-- –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_USER_ID, AMOUNT, PAYMENT_ID –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

UPDATE "User"
SET "balance" = "balance" + AMOUNT
WHERE "id" = 'YOUR_USER_ID';

INSERT INTO "Transaction" (id, "userId", amount, type, reason, status, "paymentId", "createdAt")
VALUES (
  gen_random_uuid()::text,
  'YOUR_USER_ID',
  AMOUNT,
  'deposit',
  '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –¢-–ë–∞–Ω–∫ (—Ä—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ, PaymentId: PAYMENT_ID)',
  'completed',
  'PAYMENT_ID',
  NOW()
);
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –≤–µ–±—Ö—É–∫–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω URL –≤–µ–±—Ö—É–∫–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –¢-–ë–∞–Ω–∫–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `TBANK_PASSWORD`
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ API
- [ ] –ü–æ–ø—Ä–æ–±–æ–≤–∞–Ω–∞ —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ UI –∏–ª–∏ API
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

## üîß –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤–µ–±—Ö—É–∫–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[WEBHOOK]`
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –≤—Å–µ —ç—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –æ—à–∏–±–∫–∏ —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

## üìû –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞

1. –°–æ–±–µ—Ä–∏—Ç–µ –ª–æ–≥–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[WEBHOOK]`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –¢-–ë–∞–Ω–∫–µ
3. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¢-–ë–∞–Ω–∫–∞: acq_help@tbank.ru
4. –£–∫–∞–∂–∏—Ç–µ PaymentId –∏ –≤—Ä–µ–º—è –ø–ª–∞—Ç–µ–∂–∞

---

**–í–∞–∂–Ω–æ:** –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–µ–±—Ö—É–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ.
