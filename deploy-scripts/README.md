# üõ†Ô∏è –°–∫—Ä–∏–ø—Ç—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è NESI

–≠—Ç–∞ –ø–∞–ø–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è NESI –Ω–∞ VPS —Å–µ—Ä–≤–µ—Ä–µ.

## üìÅ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ

### üöÄ –°–∫—Ä–∏–ø—Ç—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

#### `setup-server.sh`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–∏—Å—Ç–æ–≥–æ Ubuntu —Å–µ—Ä–≤–µ—Ä–∞  
**–ó–∞–ø—É—Å–∫:** `sudo bash setup-server.sh`  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**

- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º—É
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Node.js 20.x
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç PostgreSQL
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç PM2
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Nginx
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Certbot (–¥–ª—è SSL)
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Ñ–∞–π—Ä–≤–æ–ª
- –°–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –¥–µ–ø–ª–æ—è

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~10 –º–∏–Ω—É—Ç

---

#### `deploy.sh`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ  
**–ó–∞–ø—É—Å–∫:** `bash deploy.sh`  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**

1. –°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ë–î
2. –ü–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ Git
3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
4. –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
5. –°–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç
6. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
7. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~3-5 –º–∏–Ω—É—Ç

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```bash
cd /home/nesi/nesi-app
bash deploy-scripts/deploy.sh
```

---

#### `backup-db.sh`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö  
**–ó–∞–ø—É—Å–∫:** `bash backup-db.sh`  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**

- –°–æ–∑–¥–∞–µ—Ç –¥–∞–º–ø PostgreSQL –±–∞–∑—ã
- –°–∂–∏–º–∞–µ—Ç —Ñ–∞–π–ª (gzip)
- –£–¥–∞–ª—è–µ—Ç –±—ç–∫–∞–ø—ã —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –±—ç–∫–∞–ø–æ–≤

**–ú–µ—Å—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:** `/home/nesi/backups/`

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (cron):**

```bash
crontab -e
# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞ –≤ 2 –Ω–æ—á–∏:
0 2 * * * /home/nesi/backup-db.sh
```

---

#### `health-check.sh`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
**–ó–∞–ø—É—Å–∫:** `bash health-check.sh`  
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**

- ‚úÖ PM2 –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—â–µ–Ω
- ‚úÖ –ü–æ—Ä—Ç 3000 —Å–ª—É—à–∞–µ—Ç—Å—è
- ‚úÖ HTTP –æ—Ç–≤–µ—Ç –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ PostgreSQL —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Nginx —Ä–∞–±–æ—Ç–∞–µ—Ç
- üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
- üìú –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```bash
bash deploy-scripts/health-check.sh
```

---

### ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

#### `nginx-config.conf`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx –¥–ª—è NESI  
**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**

```bash
sudo cp deploy-scripts/nginx-config.conf /etc/nginx/sites-available/nesi
sudo nano /etc/nginx/sites-available/nesi  # –ó–∞–º–µ–Ω–∏—Ç–µ yourdomain.com
sudo ln -s /etc/nginx/sites-available/nesi /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- ‚ö° –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è Next.js
- üì° –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è SSE (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)
- üì¶ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
- üóúÔ∏è Gzip —Å–∂–∞—Ç–∏–µ
- üì§ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –¥–æ 100MB

---

## üìã –¢–∏–ø–∏—á–Ω—ã–π workflow

### –ü–µ—Ä–≤–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

```bash
# 1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (–∫–∞–∫ root)
sudo bash deploy-scripts/setup-server.sh

# 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL
sudo -u postgres psql
# CREATE DATABASE nesi_db;
# CREATE USER nesi_user WITH PASSWORD 'password';
# GRANT ALL PRIVILEGES ON DATABASE nesi_db TO nesi_user;

# 3. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è nesi
su - nesi

# 4. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
git clone <repo-url> nesi-app
cd nesi-app

# 5. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
nano .env  # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
npm ci --production=false
npx prisma migrate deploy
npm run build
pm2 start ecosystem.config.js
pm2 startup
pm2 save

# 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx (–∫–∞–∫ root)
exit  # –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ root
sudo cp /home/nesi/nesi-app/deploy-scripts/nginx-config.conf /etc/nginx/sites-available/nesi
sudo nano /etc/nginx/sites-available/nesi  # –ò–∑–º–µ–Ω–∏—Ç—å –¥–æ–º–µ–Ω
sudo ln -s /etc/nginx/sites-available/nesi /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx

# 7. SSL
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
cd /home/nesi/nesi-app
bash deploy-scripts/deploy.sh
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```bash
bash deploy-scripts/health-check.sh
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
bash deploy-scripts/backup-db.sh
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö

–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–µ–∫—Ü–∏—é `–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è` –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞. –í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å:

**backup-db.sh:**

```bash
DB_USER="nesi_user"          # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î
DB_NAME="nesi_db"            # –ò–º—è –ë–î
BACKUP_DIR="/home/nesi/backups"  # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –±—ç–∫–∞–ø–æ–≤
RETENTION_DAYS=7             # –°–∫–æ–ª—å–∫–æ –¥–Ω–µ–π —Ö—Ä–∞–Ω–∏—Ç—å –±—ç–∫–∞–ø—ã
```

**deploy.sh:**

```bash
APP_DIR="/home/nesi/nesi-app"   # –ü—É—Ç—å –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
APP_NAME="nesi-app"             # –ò–º—è PM2 –ø—Ä–æ—Ü–µ—Å—Å–∞
```

**health-check.sh:**

```bash
APP_NAME="nesi-app"           # –ò–º—è PM2 –ø—Ä–æ—Ü–µ—Å—Å–∞
APP_URL="http://localhost:3000"  # URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```

---

## üÜò –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –°–∫—Ä–∏–ø—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π
chmod +x deploy-scripts/*.sh

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞
ls -la deploy-scripts/
```

### –û—à–∏–±–∫–∞ "command not found"

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ bash
bash deploy-scripts/script-name.sh

# –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ sh (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º)
```

### Permission denied

```bash
# –î–ª—è —Å–∫—Ä–∏–ø—Ç–æ–≤ —Ç—Ä–µ–±—É—é—â–∏—Ö sudo
sudo bash deploy-scripts/setup-server.sh

# –î–ª—è –æ–±—ã—á–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
bash deploy-scripts/deploy.sh
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **[VPS_DEPLOYMENT_GUIDE.md](../VPS_DEPLOYMENT_GUIDE.md)** - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- **[QUICK_START_DEPLOY.md](../QUICK_START_DEPLOY.md)** - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- **[DEPLOYMENT_NOTES.md](../DEPLOYMENT_NOTES.md)** - –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ SSE

---

## ü§ù –í–∫–ª–∞–¥

–ï—Å–ª–∏ –≤—ã —É–ª—É—á—à–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç—ã –∏–ª–∏ –Ω–∞—à–ª–∏ –±–∞–≥ - —Å–æ–∑–¥–∞–π—Ç–µ Pull Request!

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã** –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ –ø–µ—Ä–µ–¥ production
2. **–î–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø—ã** –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º deploy.sh
3. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏** –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–µ–ø–ª–æ—è
4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –¥–ª—è production —Å–µ—Ä–≤–µ—Ä–∞

---

–£–¥–∞—á–∏ —Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º! üöÄ
