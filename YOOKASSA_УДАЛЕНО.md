# ‚úÖ YooKassa –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∞ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞

**–î–∞—Ç–∞:** 30 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–∏—á–∏–Ω–∞:** YooKassa –æ—Ç–∫–∞–∑–∞–ª–∞ –≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏

---

## üóëÔ∏è –ß—Ç–æ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ:

### 1. **API Routes** (—É–¥–∞–ª–µ–Ω–æ 3 —Ñ–∞–π–ª–∞)
- ‚ùå `src/app/api/wallet/create-payment/route.ts` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
- ‚ùå `src/app/api/wallet/check-payment/route.ts` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- ‚ùå `src/app/api/wallet/yookassa-webhook/route.ts` - –≤–µ–±—Ö—É–∫

### 2. **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏**
- ‚ùå `src/lib/yookassa.ts` - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å YooKassa API

### 3. **UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**
- ‚ùå `src/components/DepositBalanceModal.tsx` - –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚ùå –ö–Ω–æ–ø–∫–∞ "üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ –ÆKassa" –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è

### 4. **–°—Ç—Ä–∞–Ω–∏—Ü—ã**
- ‚ùå `src/app/wallet/payment-result/page.tsx` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞

### 5. **–£–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö**
–û–±–Ω–æ–≤–ª–µ–Ω—ã —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ (–±–µ–∑ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è YooKassa):
- ‚úÖ `src/app/register/page.tsx` - –ø–ª–∞—à–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ `src/app/terms/page.tsx` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ
- ‚úÖ `src/app/about/page.tsx` - –æ –ø—Ä–æ–µ–∫—Ç–µ
- ‚úÖ `src/app/privacy/page.tsx` - –ø–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ `src/app/offer/page.tsx` - –ø—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞

---

## ‚úÖ –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### 1. **–°–∏—Å—Ç–µ–º–∞ –±–∞–ª–∞–Ω—Å–æ–≤** üí∞
```typescript
// –ú–æ–¥–µ–ª—å User –≤ –ë–î:
balance       Decimal  @default(100.00)  // –û—Å–Ω–æ–≤–Ω–æ–π –±–∞–ª–∞–Ω—Å
frozenBalance Decimal  @default(0.00)    // –ó–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞
```

### 2. **–°–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** üìä
```typescript
// –ú–æ–¥–µ–ª—å Transaction:
- userId      // –ö—Ç–æ
- amount      // –°—É–º–º–∞
- type        // deposit, withdraw, freeze, commission
- reason      // –û–ø–∏—Å–∞–Ω–∏–µ
- status      // pending, completed
```

### 3. **–°–∏—Å—Ç–µ–º–∞ —ç—Å–∫—Ä–æ—É (–∑–∞–º–æ—Ä–æ–∑–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤)** üîí

**–ü—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è:**
```typescript
// src/app/api/tasks/[id]/assign/route.ts
// –°—Ä–µ–¥—Å—Ç–≤–∞ –∑–∞–º–æ—Ä–∞–∂–∏–≤–∞—é—Ç—Å—è:
balance: { decrement: price }
frozenBalance: { increment: price }
```

**–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏:**
```typescript
// src/app/api/tasks/[id]/complete/route.ts
// –†–∞–∑–º–æ—Ä–∞–∂–∏–≤–∞—é—Ç—Å—è –∏ –ø–µ—Ä–µ–≤–æ–¥—è—Ç—Å—è —Å –∫–æ–º–∏—Å—Å–∏–µ–π 20%:
const commission = escrowAmount * 0.20
const payout = escrowAmount - commission
// –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç 80%, –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ 20%
```

### 4. **–†–∞–±–æ—á–∏–µ API endpoints** üîå
- ‚úÖ `GET /api/wallet/balance` - –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å
- ‚úÖ `GET /api/wallet/transactions` - –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ `POST /api/wallet/deposit` - –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å (–≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
- ‚úÖ `POST /api/wallet/withdraw` - –≤—ã–≤–µ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞
- ‚úÖ `POST /api/tasks/[id]/assign` - –Ω–∞–∑–Ω–∞—á–∏—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (—ç—Å–∫—Ä–æ—É)
- ‚úÖ `PATCH /api/tasks/[id]/complete` - –∑–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É (–≤—ã–ø–ª–∞—Ç–∞)
- ‚úÖ `POST /api/tasks/[id]/cancel` - –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–¥–∞—á—É (–≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤)

### 5. **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞** üéØ
- ‚úÖ –ö–æ–º–∏—Å—Å–∏—è 20% —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –≠—Å–∫—Ä–æ—É –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –≤—ã–ø–ª–∞—Ç—ã
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤
- ‚úÖ –ó–∞–º–æ—Ä–æ–∑–∫–∞/—Ä–∞–∑–º–æ—Ä–æ–∑–∫–∞ –±–∞–ª–∞–Ω—Å–∞

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–π –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –¢-–ë–∞–Ω–∫–∞:

#### 1. **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É**
```typescript
// src/lib/tbank.ts
export async function createTBankPayment({ amount, description }) {
  // –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ API –¢-–ë–∞–Ω–∫–∞
}

export async function checkTBankPayment(paymentId: string) {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞
}
```

#### 2. **–°–æ–∑–¥–∞—Ç—å API —Ä–æ—É—Ç—ã**
```typescript
// src/app/api/wallet/tbank/create-payment/route.ts
// –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

// src/app/api/wallet/tbank/webhook/route.ts
// –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç –¢-–ë–∞–Ω–∫–∞
```

#### 3. **–î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ –ø—Ä–æ—Ñ–∏–ª—å:
<button onClick={() => createPayment()}>
  üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ –¢-–ë–∞–Ω–∫
</button>
```

#### 4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```bash
# .env
TBANK_TERMINAL_KEY=–≤–∞—à_–∫–ª—é—á
TBANK_SECRET_KEY=–≤–∞—à_—Å–µ–∫—Ä–µ—Ç
PLATFORM_OWNER_ID=id_–≤–ª–∞–¥–µ–ª—å—Ü–∞_–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
```

#### 5. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π endpoint deposit**
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ –¢-–ë–∞–Ω–∫, –≤—ã–∑–≤–∞—Ç—å:
```typescript
POST /api/wallet/deposit
{
  "amount": 1000
}
```

---

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç—ã –ª–æ–≥–∏–∫–∏ (–±–µ–∑ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã):

1. **‚úÖ –ë–∞–ª–∞–Ω—Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
   ```bash
   GET /api/wallet/balance
   # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: balance, frozenBalance, availableBalance
   ```

2. **‚úÖ –≠—Å–∫—Ä–æ—É —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è**
   ```bash
   POST /api/tasks/[id]/assign
   # –°—Ä–µ–¥—Å—Ç–≤–∞ –∑–∞–º–æ—Ä–∞–∂–∏–≤–∞—é—Ç—Å—è, frozenBalance —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è
   ```

3. **‚úÖ –ö–æ–º–∏—Å—Å–∏—è 20% —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏**
   ```bash
   PATCH /api/tasks/[id]/complete
   # –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç 80%, –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ 20%
   ```

4. **‚úÖ –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**
   ```bash
   POST /api/tasks/[id]/cancel
   # frozenBalance —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è, balance –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
   ```

---

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

### –î–æ (—Å YooKassa):
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -> YooKassa UI -> YooKassa API -> –í–µ–±—Ö—É–∫ -> Deposit
```

### –°–µ–π—á–∞—Å (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ):
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -> [–õ—é–±–∞—è —Å–∏—Å—Ç–µ–º–∞] -> Webhook/–ü—Ä–æ–≤–µ—Ä–∫–∞ -> Deposit API
```

### –ü–æ—Å–ª–µ (—Å –¢-–ë–∞–Ω–∫–æ–º):
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -> T-Bank UI -> T-Bank API -> –í–µ–±—Ö—É–∫ -> Deposit API
```

**Deposit API —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ —Å –ª—é–±–æ–π —Å–∏—Å—Ç–µ–º–æ–π!**

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:

1. **–ú–æ–¥–µ–ª–∏ –ë–î –Ω–µ —Ç—Ä–æ–≥–∞–ª–∏** - –≤—Å—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –±–∞–ª–∞–Ω—Å–∞–º–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
2. **–≠—Å–∫—Ä–æ—É —Ä–∞–±–æ—Ç–∞–µ—Ç** - –∑–∞–º–æ—Ä–æ–∑–∫–∞/—Ä–∞–∑–º–æ—Ä–æ–∑–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
3. **–ö–æ–º–∏—Å—Å–∏–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è** - 20% –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏
4. **Deposit endpoint –≥–æ—Ç–æ–≤** - –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–∞

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¢-–ë–∞–Ω–∫–∞:

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API:** https://www.tbank.ru/kassa/dev/
- **–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞:** https://www.tbank.ru/business/ecom/
- **Telegram –ø–æ–¥–¥–µ—Ä–∂–∫–∞:** @tbank_acquiring

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. ‚úÖ –î–æ–∂–¥–∞—Ç—å—Å—è –æ–¥–æ–±—Ä–µ–Ω–∏—è –æ—Ç –¢-–ë–∞–Ω–∫–∞
2. ‚è≥ –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø—ã –∫ API (terminal_key, secret_key)
3. ‚è≥ –°–æ–∑–¥–∞—Ç—å —Ä–æ—É—Ç—ã –¥–ª—è –¢-–ë–∞–Ω–∫–∞ (`/api/wallet/tbank/`)
4. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å UI –∫–Ω–æ–ø–∫—É –≤ –ø—Ä–æ—Ñ–∏–ª—å
5. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
6. ‚è≥ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–Ω

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–π –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã!  
**–ë–ª–æ–∫–µ—Ä—ã:** –ù–µ—Ç. –í—Å—è –ª–æ–≥–∏–∫–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞ –æ—Ç –ø–ª–∞—Ç–µ–∂–∫–∏.

**–í—Ä–µ–º—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¢-–ë–∞–Ω–∫–∞:** ~2-4 —á–∞—Å–∞ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–≤.

