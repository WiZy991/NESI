Подпись с помощью токена
Подпись с помощью токена возможно использовать только при работе с 3DS-методами при привязке карт и получении справки по операции

Для генерации подписи используется пароль (параметр Password) от терминала A2C

Собрать массив всех передаваемых параметров в виде пар Ключ-Значение:
В массив нужно добавить только параметры корневого объекта. Вложенные объекты и массивы не участвуют в расчете токена

[{"TerminalKey","TestB"}, {"isNeedRrn",true}, {"PaymentId","20150"}]
Добавить в массив пару (Password, значение):
[{"TerminalKey","TestB"}, {"isNeedRrn",true}, {"PaymentId","20150"}, {"Password","Dfsfh56dgKl"}]
Отсортировать массив по Ключам по алфавиту с учетом регистра:
[{"Password", "Dfsfh56dgKl"}, {"PaymentId","20150"}, {"TerminalKey","TestB"}, {"isNeedRrn",true}]
Конкатенировать значения всех пар:
Dfsfh56dgKl20150TestBtrue
Вычислить SHA-256 от полученного в предыдущем пункте значения и записать значение в Token.
Формирование подписи запроса Token завершено.

Методы работы с сертификатами
Добавление сертификата
Добавляет новый сертификат для терминала для подписи запросов. Для терминала может быть загружено несколько сертификатов. Запрос AddCertificate должен быть подписан с помощью текущего сертификата, у которого еще не истек срок действия.

Сертификат должен соответствовать требованиям:

Файл не поврежден.
Формат файла ".cer".
Загружается именно открытая часть ключа.
Алгоритм подписи подходит под используемые:
|"1.2.643.7.1.1.3.2" | "Алгоритм цифровой подписи ГОСТ Р 34.10-2012 для ключей длины 256 бит";
|"1.2.643.7.1.1.3.3" | "Алгоритм цифровой подписи ГОСТ Р 34.10-2012 для ключей длины 512 бит".

Алгоритм подписи для RSA-сертификата:
sha 256RSA
Содержимое файла начинается со строки "-----BEGIN CERTIFICATE-----", заканчивается "-----END CERTIFICATE-----".
Сертификат должен быть закодирован с помощью Base-64.
Request Body schema: multipart/form-data
TerminalKey
required
string
Идентификатор терминала. Выдается мерчанту в Т‑Бизнес при заведении терминала

Certificate
required
object
Сертификат в формате .cer.
При загрузке проверяется, что содержимое файла начинается со строки
-----BEGIN CERTIFICATE-----

DigestValue
required
string
Значение хеша в Base64

SignatureValue
required
string
Значение подписи в Base64

X509SerialNumber
required
string
Серийный номер сертификата, которым подписан запрос. Можно найти в составе сертификата или на сайте, вставив открытую часть сертификата

Responses
200
OK


post
/e2c/v2/AddCertificate
Response samples
200
Content type
application/json

Copy
{
"Success": true,
"ErrorCode": "0",
"TerminalKey": "TinkoffBankTest",
"X509SerialNumber": "2613832945",
"StartDate": "14.03.2022 15:53:55",
"ExpirationDate": "14.03.2024 15:53:55"
}
Изменение статуса сертификата
Метод позволяет активировать или заблокировать выбранный сертификат без обращения в поддержку.
Запрос должен быть подписан с помощью текущего сертификата, у которого еще не истек срок действия

Request Body schema: application/json
TerminalKey
required
string
Идентификатор терминала. Выдается мерчанту в Т‑Бизнес при заведении терминала

TargetX509SerialNumber
required
string
Серийный номер сертификата, для которого необходимо обновить статус. Можно найти в составе сертификата или на сайте, вставив открытую часть сертификата

SetStatus
required
string
Новый статус сертификата.
Возможные значения
• Active — активен,
• Blocked — заблокирован.
Если переданный в запросе статус совпадает с текущим статусом, запрос считается успешным, и статус сертификата не меняется

DigestValue
required
string
Значение хеша в Base64

SignatureValue
required
string
Значение подписи в Base64

X509SerialNumber
required
string
Серийный номер сертификата, которым подписан запрос. Можно найти в составе сертификата или на сайте, вставив открытую часть сертификата

Responses
200
OK