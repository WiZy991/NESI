# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é SSE (Server-Sent Events)

## ‚ö†Ô∏è –í–ê–ñ–ù–û: SSE –∏ Serverless –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

Server-Sent Events (SSE) –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ **–ù–ï –†–ê–ë–û–¢–ê–ï–¢** –Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é serverless –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö —Ç–∏–ø–∞ Vercel –∏–∑-–∑–∞:

1. –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –∏–Ω—Å—Ç–∞–Ω—Å–æ–º
2. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏
3. Long-running connections –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã (timeout ~30-60 —Å–µ–∫—É–Ω–¥)

---

## ‚úÖ –†–µ—à–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: Vercel —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ (—Ç–µ–∫—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ)

**–°—Ç–∞—Ç—É—Å:** –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç  
**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**

- SSE —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –º–æ–≥—É—Ç —Ä–∞–∑—Ä—ã–≤–∞—Ç—å—Å—è
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ SSE connection –∏ API –∑–∞–ø—Ä–æ—Å –ø–æ–ø–∞–¥–∞—é—Ç –Ω–∞ –æ–¥–∏–Ω –∏–Ω—Å—Ç–∞–Ω—Å
- –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**

- –î–æ–±–∞–≤–ª–µ–Ω `runtime = 'nodejs'` –≤ `/api/notifications/stream/route.ts`
- –î–æ–±–∞–≤–ª–µ–Ω `dynamic = 'force-dynamic'` –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

**–î–ª—è –¥–µ–ø–ª–æ—è:**

```bash
npm run build
vercel --prod
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: VPS/Dedicated Server (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç  
**–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã:** DigitalOcean, AWS EC2, Hetzner, –ª—é–±–æ–π VPS

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- SSE —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- –ù–µ—Ç timeout –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–µ—Ä–≤–µ—Ä–æ–º

**–î–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ VPS:**

```bash
# 1. –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
npm run build

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
npm start
# –∏–ª–∏ —Å PM2
pm2 start npm --name "nesi" -- start

# 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx reverse proxy
# /etc/nginx/sites-available/nesi
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # –í–∞–∂–Ω–æ –¥–ª—è SSE
    location /api/notifications/stream {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Connection '';
        proxy_buffering off;
        proxy_cache off;
        chunked_transfer_encoding off;
        proxy_read_timeout 86400s;
    }
}
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: WebSockets –≤–º–µ—Å—Ç–æ SSE

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ  
**–¢—Ä–µ–±—É–µ—Ç:** –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–¥–∞

–ó–∞–º–µ–Ω–∏—Ç—å SSE –Ω–∞ WebSockets –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É Socket.io

---

### –í–∞—Ä–∏–∞–Ω—Ç 4: Pusher/Ably (–æ–±–ª–∞—á–Ω—ã–π —Å–µ—Ä–≤–∏—Å)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª—é–±–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ  
**–°—Ç–æ–∏–º–æ—Å—Ç—å:** –û—Ç $0 (free tier) –¥–æ $49+/–º–µ—Å—è—Ü

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**

```bash
npm install pusher-js
npm install pusher
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Vercel
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ù–∞–¥–µ–∂–Ω–æ

---

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –≥–¥–µ –ø—Ä–æ–±–ª–µ–º–∞

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

```bash
vercel logs
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (DevTools ‚Üí Network)

- –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `/api/notifications/stream`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `200` –∏ `EventStream`
- –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å `502` –∏–ª–∏ `504` - –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `üîî SSE –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ`
- –ó–µ–ª–µ–Ω–∞—è —Ç–æ—á–∫–∞ –≤–æ–∑–ª–µ –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫–∞
- Heartbeat –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥

---

## üìù –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –§–∞–π–ª—ã —Å SSE:

- `/api/notifications/stream/route.ts` - SSE endpoint
- `/components/Header.tsx` - –∫–ª–∏–µ–Ω—Ç SSE

### API endpoints, –æ—Ç–ø—Ä–∞–≤–ª—è—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:

- `/api/messages/send/route.ts` - –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `/api/tasks/[id]/messages/route.ts` - —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∑–∞–¥–∞—á–∞—Ö
- `/api/tasks/[id]/responses/route.ts` - –æ—Ç–∫–ª–∏–∫–∏ –Ω–∞ –∑–∞–¥–∞—á–∏
- `/api/hire/route.ts` - –∑–∞–ø—Ä–æ—Å—ã –Ω–∞–π–º–∞
- `/api/tasks/[id]/review/route.ts` - –æ—Ç–∑—ã–≤—ã
- `/api/tasks/[id]/complete/route.ts` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á

---

## üõ†Ô∏è –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (fallback)

–ï—Å–ª–∏ SSE –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å fallback –º–µ—Ö–∞–Ω–∏–∑–º–æ–º:

1. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
2. –ö–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
3. Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è, –Ω–æ —Å—á–µ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

---

## üìû –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

–î–ª—è **–ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞** —Ä–µ–∫–æ–º–µ–Ω–¥—É—é:

1. **–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VPS (DigitalOcean –æ—Ç $6/–º–µ—Å—è—Ü)
2. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ:** –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ WebSockets –∏–ª–∏ Pusher –¥–ª—è –ª—É—á—à–µ–π –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏

---

## üîÑ –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏:

1. –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+R)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é –≤ DevTools ‚Üí Network ‚Üí Headers
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–æ–≤—ã–π –±–∏–ª–¥ –∑–∞–¥–µ–ø–ª–æ–µ–Ω: `vercel ls`
