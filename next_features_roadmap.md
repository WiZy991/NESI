# NESI — Дорожная карта согласованных улучшений

_Обновлено: 2025‑11‑08_

Этот документ фиксирует согласованный порядок работ и детализирует каждую доработку. Выполняем блоки последовательно сверху вниз.

---

## 1. Чат

### 1.1 Статусы активности
- **Цель:** честно отражать «печатает», «прочитал», «был онлайн …» без залипаний и ложных срабатываний.
- **Текущая проблема:** статус «печатает» иногда не сбрасывается; не видно времени последнего прочтения; индикация спрятана.
- **Задачи:**
  - Нормализовать API `/api/typing`: дебаунс, auto-off через 5 сек, отправка `stoppedTyping`.
  - Хранить `lastReadAt`/`lastActivityAt` (SSE и БД), отображать в хедере чата.
  - На фронте (`src/app/chats/page.tsx`, `ChatHeader`) вынести статус под именем, показать подсказку («прочитано 2 мин назад»).
  - Обновить очистку стейта при смене чата и закрытии вкладки.
- **Отчётность:** e2e сценарии «A печатает → B видит», «A закрывает вкладку → статус исчез».

### 1.2 Галерея вложений
- **Цель:** быстрый просмотр/поиск файлов в чате.
- **Задачи:**
  - Backend: метод `GET /api/chats/{id}/attachments?type=all|image|doc&search=`. Возвращать id сообщения, имя файла, mime, размер, thumbnail (если есть).
  - Frontend: панель «Вложения» в правом сайдбаре или модалке. Фильтры по типам, поиск по названию, сортировка по дате.
  - Клик открывает модальное превью и скроллит чат к сообщению.
  - Обработать удалённые/недоступные файлы (placeholder, retry).

---

## 2. Сообщество

### 2.1 Карма, бейджи, топ недели
- Счётчик кармы (лайк +1, дизлайк −1, админ может скорректировать).
- Сервис выборки «Лучшие посты недели» (scheduler + страница + блок на главной).
- Бейджи за суммарный рейтинг/активность (использовать существующую систему наград).

### 2.2 Тематические теги и подписки
- Добавить таблицу `CommunityTag`, связь many-to-many.
- Редактирование тегов при создании/редактировании поста; авто‑подсказки.
- Страница тега с лентой; подписка на тег → уведомления/дайджест.
- Cron/worker для отправки рассылки «Лучшее по подпискам» (email + внутри платформы).

### 2.3 Модерация 2.0
- Сохранить текущие функции, расширить:
  - Очередь жалоб со статусами (`new`, `in_review`, `action_taken`, `dismissed`).
  - Панель модератора: фильтры, история решений.
  - Простые антиспам‑правила (rate-limit, стоп‑слова, автоматический флаг «подозрительно»).

---

## 3. Каталог задач

### 3.1 Умные рекомендации
- Подбор задач по навыкам исполнителя, истории откликов, избранному.
- Бэкенд: сервис `TaskRecoService` (вычисление score, кеширование).
- UI: блок «Рекомендуем для вас» + маркеры в списке задач.
- Метрики: собирать клики/отклики → улучшать алгоритм (A/B в будущем).
- Доп. идеи после запуска: «скрыть похожие», «показать новые за сутки».

---

## 4. Мои отклики

### 4.1 Статус‑трекер
- Состояния: `pending`, `viewed`, `responded`, `hired`, `rejected`.
- UI: табы/фильтры, badge в списке, таймлайн в карточке.

### 4.2 Автоматические напоминания
- Worker/Scheduled job: если 48 часов без движения → уведомление исполнителю и мягкий пинг заказчику (через предпочтительный канал).
- Настройки уведомлений: включить/выключить напоминания.

### 4.3 Шаблоны откликов (самостоятельное создание)
- Отдельный раздел в профиле + быстрый выбор в форме отклика (вставка переменных: цена, срок, имя).

### 4.4 Аналитика
- Дашборд: конверсия откликов, средняя ставка, топ‑категории по успеху, среднее время ответа заказчика.
- Экспорт в CSV/JSON (reuse механики экспорта).

---

## 5. Мои заказы (как заказчик)

### 5.1 Канбан‑доска
- Колонки `TODO`, `In Progress`, `Review`, `Done`.
- Drag&drop карточек; события в Activity log.
- Фильтры по исполнителю, сроку, бюджету.

### 5.2 Дублирование задач
- Кнопка «Создать копию» → модалка выбора, что перенести (описание, файлы, бюджет).
- Зафиксировать связь «оригинал ↔ копия» (для аналитики).

---

## 6. Общие улучшения

### 6.1 Действия из уведомлений
- Для уведомлений «новый отклик»/«сообщение» добавить кнопки «Ответить», «Принять», «Открыть чат».
- Backend: обеспечить id сущности в payload, обновить SSE.

### 6.2 Глобальный поиск
- Индексировать задачи, чаты, пользователей.
- UI: Cmd/Ctrl + K → единый поиск с фильтрами, предпросмотр карточек.

### 6.3 PWA и офлайн
- МанIFEST + service worker: офлайн кеш главных страниц, пуш‑уведомления.
- Карточки быстродействий на главном экране (install prompt).

### 6.4 Инструменты качества
- Раздел с best practices и чеклистами (markdown контент + поиск).
- Вставить линк на раздел в хедер/онбординг.

### 6.5 AI/автоаналитика (отложено)
- Фиксируем в бэклоге: автосаммари чатов и задач, авто‑теги, подсказки по ставке.
- Вернуться после реализации блоков 1–6.

---

## Дополнительные заметки
- **Приоритет:** выполнение задания → проверка → короткий отчёт → переход к следующему подпункту.
- **Инфраструктура:** все новые API покрывать DTO/валидацией; для long-running задач использовать worker/SSE.
- **Дизайн:** придерживаться текущего dark‑theme UI, подготовить макеты в Figma для сложных экранов (канбан, галерея).
- **Тестирование:** регрессионные тесты на чат и уведомления, smoke-тест PWA.
- **Документация:** после каждого блока обновлять README/Release Notes.


