# ‚ö†Ô∏è –ü–æ—á–µ–º—É DealId –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –∏ –Ω–µ–ª—å–∑—è —É–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É

## ‚ùå –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è —É–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É DealId

**DealId –û–ë–Ø–ó–ê–¢–ï–õ–ï–ù –¥–ª—è –≤—ã–ø–ª–∞—Ç –≤ —Ä–∞–º–∫–∞—Ö –º—É–ª—å—Ç–∏—Ä–∞—Å—á–µ—Ç–æ–≤ –¢-–ë–∞–Ω–∫–∞.**

–°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¢-–ë–∞–Ω–∫–∞ (`multisplit.md`, `vyplaty-multisplit.md`):
- –í—ã–ø–ª–∞—Ç—ã –≤–æ–∑–º–æ–∂–Ω—ã **—Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–¥–µ–ª–∫–∏** (DealId)
- –ë–µ–∑ DealId –¢-–ë–∞–Ω–∫ **–æ—Ç–∫–ª–æ–Ω–∏—Ç** –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–ø–ª–∞—Ç—É
- –≠—Ç–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ API –¢-–ë–∞–Ω–∫–∞, –∞ –Ω–µ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º—ã

**–ï—Å–ª–∏ —É–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É DealId:**
- –í—ã–ø–ª–∞—Ç—ã –±—É–¥—É—Ç **–≤—Å–µ–≥–¥–∞ –æ—Ç–∫–ª–æ–Ω—è—Ç—å—Å—è** –¢-–ë–∞–Ω–∫–æ–º
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Å–º–æ–≥—É—Ç –≤—ã–≤–µ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞
- –°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üîç –ü–æ—á–µ–º—É DealId = N/A –ø—Ä–∏ —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ

### –ü—Ä–æ–±–ª–µ–º–∞: GetState –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç DealId

**–°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¢-–ë–∞–Ω–∫–∞:**
- `SpAccumulationId` (DealId) –ø—Ä–∏—Ö–æ–¥–∏—Ç **–¢–û–õ–¨–ö–û –≤ –≤–µ–±—Ö—É–∫–µ** –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ö–æ–ª–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤
- –ú–µ—Ç–æ–¥ `GetState` **–º–æ–∂–µ—Ç –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å** DealId –¥–ª—è —É–∂–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ API –¢-–ë–∞–Ω–∫–∞

**–ü—Ä–∏–º–µ—Ä –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**
```json
// –í–µ–±—Ö—É–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç SpAccumulationId:
{
  "Status": "CONFIRMED",
  "PaymentId": "2006896",
  "SpAccumulationId": 756439112,  // ‚Üê DealId –∑–¥–µ—Å—å!
  "Token": "..."
}

// GetState –º–æ–∂–µ—Ç –ù–ï —Å–æ–¥–µ—Ä–∂–∞—Ç—å SpAccumulationId:
{
  "Status": "CONFIRMED",
  "PaymentId": "2006896",
  // SpAccumulationId –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç!
}
```

---

## ‚úÖ –†–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –î–æ–∂–¥–∞—Ç—å—Å—è –≤–µ–±—Ö—É–∫–∞ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

**–í–µ–±—Ö—É–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
- URL: `https://nesi.su/api/wallet/tbank/webhook` ‚úÖ
- –°—Ç–∞—Ç—É—Å: –ê–∫—Ç–∏–≤–µ–Ω ‚úÖ

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
1. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –ø–æ–¥–æ–∂–¥–∏—Ç–µ **1-5 –º–∏–Ω—É—Ç**
2. –í–µ–±—Ö—É–∫ –ø—Ä–∏–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. DealId —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
4. –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ –≤–µ–±—Ö—É–∫–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –ë–î - –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è DealId

---

### –†–µ—à–µ–Ω–∏–µ 2: –û–±–Ω–æ–≤–∏—Ç—å DealId —á–µ—Ä–µ–∑ API

**–ï—Å–ª–∏ –≤–µ–±—Ö—É–∫ –Ω–µ –ø—Ä–∏—à–µ–ª –∏–ª–∏ –ø—Ä–∏—à–µ–ª –±–µ–∑ DealId:**

```bash
POST https://nesi.su/api/wallet/tbank/update-deal-ids
Authorization: Bearer <–≤–∞—à_—Ç–æ–∫–µ–Ω>
```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:**
- GetState –º–æ–∂–µ—Ç –Ω–µ –≤–µ—Ä–Ω—É—Ç—å DealId
- –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ GetState –≤–µ—Ä–Ω—É–ª DealId

---

### –†–µ—à–µ–Ω–∏–µ 3: –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å –∑–∞–Ω–æ–≤–æ

**–ï—Å–ª–∏ –≤–µ–±—Ö—É–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –∑–∞–Ω–æ–≤–æ —á–µ—Ä–µ–∑ –¢-–ë–∞–Ω–∫
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–µ–±—Ö—É–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –≤–µ–±—Ö—É–∫–∞ (1-5 –º–∏–Ω—É—Ç)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ DealId —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ:

```
üîç [CHECK-PAYMENT] –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç GetState: {
  hasSpAccumulationId: false,  // ‚Üê GetState –Ω–µ –≤–µ—Ä–Ω—É–ª DealId
  hasDealId: false,
  note: 'GetState –º–æ–∂–µ—Ç –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å DealId - –æ–Ω –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≤ –≤–µ–±—Ö—É–∫–µ'
}
‚ö†Ô∏è [CHECK-PAYMENT] DealId –Ω–µ –ø–æ–ª—É—á–µ–Ω –∏–∑ GetState. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - DealId –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≤ –≤–µ–±—Ö—É–∫–µ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ö–æ–ª–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤.
```

**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!** GetState –Ω–µ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç DealId.

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤–µ–±—Ö—É–∫–∞:

```
üì• [WEBHOOK] –í—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å –æ—Ç T-Bank
üìä [WEBHOOK] –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–ª–∞—Ç–µ–∂–∞: { 
  Status: 'CONFIRMED', 
  SpAccumulationId: 756439112,  // ‚Üê DealId –∑–¥–µ—Å—å!
  DealId: null 
}
‚úÖ [WEBHOOK] –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ: { dealId: '756439112', savedDealId: '756439112' }
```

**–ï—Å–ª–∏ –ª–æ–≥–æ–≤ –≤–µ–±—Ö—É–∫–∞ –Ω–µ—Ç:**
‚Üí –í–µ–±—Ö—É–∫ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç
‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±—Ö—É–∫–∞ –≤ –¢-–ë–∞–Ω–∫–µ

---

## üìä –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã

```
1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ (Init)
   ‚Üì
   PaymentId —Å–æ–∑–¥–∞–Ω
   ‚Üì
2. –û–ø–ª–∞—Ç–∞ –Ω–∞ —Ñ–æ—Ä–º–µ –¢-–ë–∞–Ω–∫–∞
   ‚Üì
   –°—Ä–µ–¥—Å—Ç–≤–∞ –∑–∞–º–æ—Ä–æ–∂–µ–Ω—ã
   ‚Üì
3. –í–µ–±—Ö—É–∫ –æ—Ç –¢-–ë–∞–Ω–∫–∞ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
   ‚Üì
   SpAccumulationId (DealId) –ø—Ä–∏—Ö–æ–¥–∏—Ç
   ‚Üì
   DealId —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   ‚Üì
4. –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤
   ‚Üì
   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è DealId –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   ‚Üì
   –í—ã–ø–ª–∞—Ç–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
```

**–ë–µ–∑ —à–∞–≥–∞ 3 (–≤–µ–±—Ö—É–∫) - DealId –Ω–µ –±—É–¥–µ—Ç, –≤—ã–≤–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!**

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å

1. **DealId –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** - –Ω–µ–ª—å–∑—è —É–±—Ä–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
2. **DealId –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≤ –≤–µ–±—Ö—É–∫–µ** - –Ω–µ –≤ GetState
3. **–í–µ–±—Ö—É–∫ –º–æ–∂–µ—Ç –ø—Ä–∏–π—Ç–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π** - –ø–æ–¥–æ–∂–¥–∏—Ç–µ 1-5 –º–∏–Ω—É—Ç
4. **–í–µ–±—Ö—É–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –¢-–ë–∞–Ω–∫–µ
5. **GetState –º–æ–∂–µ—Ç –Ω–µ –≤–µ—Ä–Ω—É—Ç—å DealId** - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ

---

## üÜò –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞** - —Ç–∞–º –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±—Ö—É–∫–∞** - URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º
3. **–°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¢-–ë–∞–Ω–∫–∞** - –≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞ –∏—Ö —Å—Ç–æ—Ä–æ–Ω–µ
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** - —Å–º. `multisplit.md`, `vyplaty-multisplit.md`

