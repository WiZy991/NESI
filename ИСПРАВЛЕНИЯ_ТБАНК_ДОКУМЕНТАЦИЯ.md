# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¢-–ë–∞–Ω–∫–∞ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## üìã –°–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ü–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¢-–ë–∞–Ω–∫–∞ (`multisplit.md`, `oplata_multisplit.md`, `vyplaty-multisplit.md`, `api_reg_upd_multisplit.md`) –±—ã–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #1: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ Token - –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –∏–∑ –ø–æ–¥–ø–∏—Å–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –í `src/lib/tbank.ts` –æ–±—ä–µ–∫—Ç—ã (–≤–∫–ª—é—á–∞—è `DATA`, `senderAccountInfo`, `recipientAccountInfo`) –≤–∫–ª—é—á–∞–ª–∏—Å—å –≤ –ø–æ–¥–ø–∏—Å—å —á–µ—Ä–µ–∑ `JSON.stringify()`, —á—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¢-–ë–∞–Ω–∫–∞ (—Ä–∞–∑–¥–µ–ª 5.1 –≤ `multisplit.md` –∏ —Ä–∞–∑–¥–µ–ª 3.1 –≤ `vyplaty-multisplit.md`), –æ–±—ä–µ–∫—Ç—ã **–ù–ï –¥–æ–ª–∂–Ω—ã** –≤–∫–ª—é—á–∞—Ç—å—Å—è –≤ –ø–æ–¥–ø–∏—Å—å Token.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤:** `src/lib/tbank.ts`, —Ñ—É–Ω–∫—Ü–∏—è `generateToken()` (—Å—Ç—Ä–æ–∫–∏ 85-120)

**–î–æ:**
```typescript
if (typeof value === 'object' && value !== null) {
    // –°–µ—Ä–∏–∞–ª–∏–∑—É–µ–º –æ–±—ä–µ–∫—Ç—ã (–≤–∫–ª—é—á–∞—è DATA) –≤ JSON –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤
    return JSON.stringify(value)
}
```

**–ü–æ—Å–ª–µ:**
```typescript
// –í–ê–ñ–ù–û: –û–±—ä–µ–∫—Ç—ã (–≤–∫–ª—é—á–∞—è DATA, senderAccountInfo, recipientAccountInfo) –ù–ï –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤ –ø–æ–¥–ø–∏—Å—å
if (typeof value === 'object' && value !== null) {
    return ''
}
```

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #2: –¢–∏–ø FinalPayout - Boolean –≤–º–µ—Å—Ç–æ String

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –∫–æ–¥–µ –¥–ª—è –°–ë–ü –≤—ã–ø–ª–∞—Ç `FinalPayout` –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ `"true"`, —Ö–æ—Ç—è —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å Boolean.

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** 
- `vyplaty-multisplit.md` —Å—Ç—Ä. 516, —Ç–∞–±–ª–∏—Ü–∞ 2.4.1: `FinalPayout Boolean –ù–µ—Ç`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤:** `src/lib/tbank.ts`, —Ñ—É–Ω–∫—Ü–∏—è `createWithdrawal()` (—Å—Ç—Ä–æ–∫–∏ 506-522)

**–î–æ:**
```typescript
// –î–ª—è –°–ë–ü –≤—ã–ø–ª–∞—Ç –ø–µ—Ä–µ–¥–∞–µ–º FinalPayout –∫–∞–∫ —Å—Ç—Ä–æ–∫—É "true"
if (params.phone && params.sbpMemberId) {
    requestBody.FinalPayout = 'true'
}
```

**–ü–æ—Å–ª–µ:**
```typescript
// –í–ê–ñ–ù–û: –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¢-–ë–∞–Ω–∫–∞ (vyplaty-multisplit.md —Å—Ç—Ä. 516)
// FinalPayout –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–∏–ø–∞ Boolean, –Ω–µ String
if (params.finalPayout === true) {
    requestBody.FinalPayout = true
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í –ø—Ä–∏–º–µ—Ä–∞—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –µ—Å—Ç—å –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ (—Å—Ç—Ä. 903 –¥–ª—è –°–ë–ü –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä–æ–∫—É `"true"`), –Ω–æ —Å–æ–≥–ª–∞—Å–Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–∏–ø–∞ - —ç—Ç–æ Boolean.

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #3: –¢–∏–ø SbpMemberId - Number –≤–º–µ—Å—Ç–æ String

**–ü—Ä–æ–±–ª–µ–º–∞:** `SbpMemberId` –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞, —Ö–æ—Ç—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å Number.

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `multisplit.md` —Å—Ç—Ä. 1083, —Ç–∞–±–ª–∏—Ü–∞ 6.2: `SbpMemberId Number –î–∞*`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤:** `src/lib/tbank.ts`, —Ñ—É–Ω–∫—Ü–∏—è `createWithdrawal()` (—Å—Ç—Ä–æ–∫–∏ 440-445)

**–î–æ:**
```typescript
requestBody.SbpMemberId = String(params.sbpMemberId)
```

**–ü–æ—Å–ª–µ:**
```typescript
// –í–ê–ñ–ù–û: –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¢-–ë–∞–Ω–∫–∞ (multisplit.md —Å—Ç—Ä. 1083)
// SbpMemberId –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–∏–ø–∞ Number, –Ω–µ String
requestBody.SbpMemberId = typeof params.sbpMemberId === 'string' 
    ? parseInt(params.sbpMemberId, 10) 
    : params.sbpMemberId
```

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #4: –¢–∏–ø DealId - Number —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** `DealId` –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞, —Ö–æ—Ç—è –≤ —Ç–∞–±–ª–∏—Ü–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —É–∫–∞–∑–∞–Ω Number.

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `vyplaty-multisplit.md` —Å—Ç—Ä. 500, —Ç–∞–±–ª–∏—Ü–∞ 2.4.1: `DealId Number –î–∞`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤:** `src/lib/tbank.ts`, —Ñ—É–Ω–∫—Ü–∏—è `createWithdrawal()` (—Å—Ç—Ä–æ–∫–∏ 412-420)

**–î–æ:**
```typescript
// –ü—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∫–∞–∫ –°–¢–†–û–ö–£, –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ –∑–∞–ø—Ä–æ—Å–∞
requestBody.DealId = String(params.dealId)
```

**–ü–æ—Å–ª–µ:**
```typescript
// –í–ê–ñ–ù–û: –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¢-–ë–∞–Ω–∫–∞ (vyplaty-multisplit.md —Å—Ç—Ä. 500)
// DealId –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–∏–ø–∞ Number (SpAccumulationId - —á–∏—Å–ª–æ–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–¥–µ–ª–∫–∏)
const dealIdNumber = typeof params.dealId === 'string' 
    ? parseInt(params.dealId, 10) 
    : params.dealId
if (isNaN(dealIdNumber as number)) {
    throw new Error(`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç DealId: ${params.dealId}`)
}
requestBody.DealId = dealIdNumber as number
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í –ø—Ä–∏–º–µ—Ä–∞—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ `DealId` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞, –Ω–æ —Å–æ–≥–ª–∞—Å–Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ - —ç—Ç–æ Number.

---

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

1. ‚úÖ **CreateDealWithType** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤–Ω–µ –±–ª–æ–∫–∞ DATA (–Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ)
2. ‚úÖ **createSpDeal** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
3. ‚úÖ **PaymentRecipientId** - –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä)
4. ‚úÖ **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ Token –≤ `src/lib/tbank/crypto.ts`** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–∫–ª—é—á–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã
5. ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø—Ä–æ—Å–æ–≤** - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

## üìå –ß—Ç–æ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ API** (`api_reg_upd_multisplit.md`)
   - –≠—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π API –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫
   - URL: `https://acqapi.tinkoff.ru/sm-register/register`
   - –¢—Ä–µ–±—É–µ—Ç—Å—è OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
   - –ù—É–∂–Ω–æ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ –º—É–ª—å—Ç–∏—Ä–∞—Å—á–µ—Ç–æ–≤
   - **–°—Ç–∞—Ç—É—Å:** –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –Ω–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è —Ç–µ–∫—É—â–µ–π —Ä–∞–±–æ—Ç—ã —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏

---

## üéØ –ò—Ç–æ–≥

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¢-–ë–∞–Ω–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:

1. ‚úÖ –û–±—ä–µ–∫—Ç—ã (DATA) –Ω–µ –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤ –ø–æ–¥–ø–∏—Å—å Token
2. ‚úÖ FinalPayout –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∫ Boolean
3. ‚úÖ SbpMemberId –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∫ Number
4. ‚úÖ DealId –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∫ Number

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¢-–ë–∞–Ω–∫–∞.

